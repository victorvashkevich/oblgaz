
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ДеревоЗначений = Параметры.ДеревоПодсистем;
	
	Дерево = ДанныеФормыВЗначение(ДеревоЗначений, Тип("ДеревоЗначений"));
	
	ЗначениеВРеквизитФормы(Дерево, "ДеревоПодсистем");
	
КонецПроцедуры

&НаКлиенте
Процедура Принять(Команда)
	
	Подсистемы.Очистить();
	
	Для каждого СтрокаПодсистемы из ДеревоПодсистем.ПолучитьЭлементы() Цикл
		Если СтрокаПодсистемы.Использование тогда
			ГруппировкаПодсистемы             	  = Подсистемы.Добавить();
			ГруппировкаПодсистемы.Подсистема      = СтрокаПодсистемы.ПутьКПодсистеме;
			ГруппировкаПодсистемы.Название        = СтрокаПодсистемы.Название;
			ГруппировкаПодсистемы.Предопределенная = СтрокаПодсистемы.Предопределенная;
		КонецЕсли;
		ДобавитьПодсистемы(СтрокаПодсистемы)
	КонецЦикла;
	
	ВозвращаемыеПараметры = Новый Структура("СписокПодсистем, ДеревоПодсистем");
	
	ВозвращаемыеПараметры.СписокПодсистем = Подсистемы;
	ВозвращаемыеПараметры.ДеревоПодсистем = ДеревоПодсистем;
	
	Закрыть(ВозвращаемыеПараметры);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьПодсистемы(СтрокаПодсистемы)
	
	Для каждого СтрокаПодсистемы из СтрокаПодсистемы.ПолучитьЭлементы() Цикл
		Если СтрокаПодсистемы.Использование тогда
			ГруппировкаПодсистема                 = Подсистемы.Добавить();
			ГруппировкаПодсистема.Подсистема      = СтрокаПодсистемы.ПутьКПодсистеме;
			ГруппировкаПодсистема.Название        = СтрокаПодсистемы.Название;
			ГруппировкаПодсистема.Предопределенная = СтрокаПодсистемы.Предопределенная;
		КонецЕсли;
		ДобавитьПодсистемы(СтрокаПодсистемы)
	КонецЦикла;
	
КонецПроцедуры
