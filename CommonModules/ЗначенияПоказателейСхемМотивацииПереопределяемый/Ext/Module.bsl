////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ МОДУЛЯ ОБЪЕКТА

Функция Автозаполнение(Организация, ПериодДействия, ТаблицаЗапроса = Неопределено, Сотрудники = Неопределено, Показатели = Неопределено, ОдинВидРасчета = Ложь, ИзДокумента = Ложь) Экспорт
	
	СписокНедоступныхВозможностейИзменения = Новый Массив;
	СписокНедоступныхВозможностейИзменения.Добавить(Перечисления.ИзменениеПоказателейСхемМотивации.ПустаяСсылка());
	СписокНедоступныхВозможностейИзменения.Добавить(Перечисления.ИзменениеПоказателейСхемМотивации.НеИзменяется);
	СписокНедоступныхВозможностейИзменения.Добавить(Перечисления.ИзменениеПоказателейСхемМотивации.ИзменяетсяПриРасчете);
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ПарамВозможностьИзменения", СписокНедоступныхВозможностейИзменения);
	Запрос.УстановитьПараметр("ПарамДата", ПериодДействия);
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ТаблицаЗапроса",ТаблицаЗапроса);
	
	
	Если ЗначениеЗаполнено(Организация) Тогда
		
		СписокНедоступныхВозможностейИзменения = Новый Массив;
		СписокНедоступныхВозможностейИзменения.Добавить(Перечисления.ИзменениеПоказателейСхемМотивации.ПустаяСсылка());
		СписокНедоступныхВозможностейИзменения.Добавить(Перечисления.ИзменениеПоказателейСхемМотивации.НеИзменяется);
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ПарамВозможностьИзменения", СписокНедоступныхВозможностейИзменения);
		Запрос.УстановитьПараметр("ПарамДата", ПериодДействия);
		
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		
		Запрос.УстановитьПараметр("ОбособленноеПодразделение", Организация);
		Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(ПериодДействия));
		Запрос.УстановитьПараметр("ГоловнаяОрганизация", ОбщегоНазначения.ГоловнаяОрганизация(Организация));
		Запрос.УстановитьПараметр("Сотрудники",Сотрудники);
		Запрос.УстановитьПараметр("Показатели",Показатели);
		
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	РаботникиОрганизаций.Сотрудник КАК Сотрудник,
		|	РаботникиОрганизаций.ПодразделениеОрганизации КАК Подразделение
		|ПОМЕСТИТЬ ВТСотрудники
		|ИЗ
		|	РегистрСведений.РаботникиОрганизаций.СрезПоследних(
		|			&ПарамДата,
		|			Организация = &ГоловнаяОрганизация";
		Если ЗначениеЗаполнено(Сотрудники) Тогда
			Запрос.Текст = Запрос.Текст + "
		|				И Сотрудник В (&Сотрудники)";
		КонецЕсли;
		Запрос.Текст = Запрос.Текст + "
		|) КАК РаботникиОрганизаций
		|ГДЕ
		|	ВЫБОР
		|			КОГДА РаботникиОрганизаций.ПериодЗавершения <= &ПарамДата
		|					И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА РаботникиОрганизаций.ОбособленноеПодразделениеЗавершения
		|			ИНАЧЕ РаботникиОрганизаций.ОбособленноеПодразделение
		|		КОНЕЦ = &ОбособленноеПодразделение
		|	И ВЫБОР
		|			КОГДА РаботникиОрганизаций.ПериодЗавершения <= &ПарамДата
		|					И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА РаботникиОрганизаций.ПричинаИзмененияСостоянияЗавершения
		|			ИНАЧЕ РаботникиОрганизаций.ПричинаИзмененияСостояния
		|		КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	РаботникиОрганизаций.Сотрудник,
		|	РаботникиОрганизаций.ПодразделениеОрганизации
		|ИЗ
		|	РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
		|ГДЕ
		|	РаботникиОрганизаций.Период > &ПарамДата
		|	И РаботникиОрганизаций.Период <= &КонецМесяца
		|	И РаботникиОрганизаций.Организация = &ГоловнаяОрганизация
		|	И РаботникиОрганизаций.ОбособленноеПодразделение = &ОбособленноеПодразделение";
		Если ЗначениеЗаполнено(Сотрудники) Тогда
			Запрос.Текст = Запрос.Текст + "
		|	И РаботникиОрганизаций.Сотрудник В(&Сотрудники)";
		КонецЕсли;
		Запрос.Текст = Запрос.Текст + "
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	Работники.Сотрудник,
		|	ПериодыПерекрытия.ПодразделениеОрганизации
		|ИЗ
		|	РегистрСведений.РаботникиОрганизаций КАК Работники
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК ПериодыПерекрытия
		|		ПО (ПериодыПерекрытия.Период <= Работники.ПериодЗавершения)
		|			И (ПериодыПерекрытия.Период > Работники.Период)
		|			И (ПериодыПерекрытия.Сотрудник = Работники.Сотрудник)
		|			И (ПериодыПерекрытия.Организация = &ГоловнаяОрганизация)
		|ГДЕ
		|	Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|	И Работники.ПериодЗавершения > &ПарамДата
		|	И Работники.ПериодЗавершения <= &КонецМесяца
		|	И Работники.Организация = &ГоловнаяОрганизация
		|	И Работники.ОбособленноеПодразделениеЗавершения = &ОбособленноеПодразделение
		|	И ПериодыПерекрытия.Период ЕСТЬ NULL";
		Если ЗначениеЗаполнено(Сотрудники) Тогда
			Запрос.Текст = Запрос.Текст + "
		|	И Работники.Сотрудник В(&Сотрудники)";
		КонецЕсли;
		Запрос.Текст = Запрос.Текст + "	
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Сотрудник
		|;
		|ВЫБРАТЬ
		|	ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Сотрудник,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 1 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель1,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 2 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель2,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 3 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель3,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 4 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель4,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 5 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель5,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 6 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель6,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 1 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный1,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 2 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный2,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 3 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный3,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 4 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный4,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 5 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный5,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 6 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный6,
		|	СУММА(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Показатель1) КАК Значение1,
		|	СУММА(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Показатель2) КАК Значение2,
		|	СУММА(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Показатель3) КАК Значение3,
		|	СУММА(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Показатель4) КАК Значение4,
		|	СУММА(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Показатель5) КАК Значение5,
		|	СУММА(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Показатель6) КАК Значение6,
		|	МАКСИМУМ(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Валюта1) КАК Валюта1,
		|	МАКСИМУМ(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Валюта2) КАК Валюта2,
		|	МАКСИМУМ(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Валюта3) КАК Валюта3,
		|	МАКСИМУМ(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Валюта4) КАК Валюта4,
		|	МАКСИМУМ(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Валюта5) КАК Валюта5,
		|	МАКСИМУМ(ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Валюта6) КАК Валюта6
		|ПОМЕСТИТЬ ВТПлановые
		|ИЗ
		|	РегистрСведений.ПлановыеНачисленияРаботниковОрганизаций.СрезПоследних(
		|			&ПарамДата,
		|			Организация = &ОбособленноеПодразделение
		|				И Сотрудник В
		|					(ВЫБРАТЬ
		|						ВТСотрудники.Сотрудник
		|					ИЗ
		|						ВТСотрудники)) КАК ПлановыеНачисленияРаботниковОрганизацийСрезПоследних
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели
		|		ПО 	(Показатели.Ссылка = ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.ВидРасчета)
		|СГРУППИРОВАТЬ ПО
		|	ПлановыеНачисленияРаботниковОрганизацийСрезПоследних.Сотрудник,
		|	Показатели.НомерСтроки,
		|	Показатели.Показатель;
		|ВЫБРАТЬ
		|	ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.ФизЛицо КАК Сотрудник,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 1 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель1,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 2 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель2,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 3 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель3,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 4 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель4,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 5 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель5,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 6 Тогда Показатели.Показатель ИНАЧЕ NULL КОНЕЦ КАК Показатель6,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 1 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный1,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 2 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный2,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 3 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный3,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 4 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный4,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 5 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный5,
		|	ВЫБОР КОГДА Показатели.НомерСтроки = 6 Тогда Показатели.Показатель.Предопределенный ИНАЧЕ NULL КОНЕЦ КАК Предопределенный6,
		|	СУММА(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Показатель1) КАК Значение1,
		|	СУММА(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Показатель2) КАК Значение2,
		|	СУММА(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Показатель3) КАК Значение3,
		|	СУММА(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Показатель4) КАК Значение4,
		|	СУММА(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Показатель5) КАК Значение5,
		|	СУММА(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Показатель6) КАК Значение6,
		|	МАКСИМУМ(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Валюта1) КАК Валюта1,
		|	МАКСИМУМ(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Валюта2) КАК Валюта2,
		|	МАКСИМУМ(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Валюта3) КАК Валюта3,
		|	МАКСИМУМ(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Валюта4) КАК Валюта4,
		|	МАКСИМУМ(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Валюта5) КАК Валюта5,
		|	МАКСИМУМ(ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.Валюта6) КАК Валюта6
		|ПОМЕСТИТЬ ВТПлановыеУд
		|ИЗ
		|	РегистрСведений.ПлановыеУдержанияРаботниковОрганизаций.СрезПоследних(
		|			&ПарамДата,
		|			Организация = &ОбособленноеПодразделение
		|				И ФизЛицо В
		|					(ВЫБРАТЬ
		|						ВТСотрудники.Сотрудник.Физлицо
		|					ИЗ
		|						ВТСотрудники)) КАК ПлановыеУдержанияРаботниковОрганизацийСрезПоследних
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.УдержанияОрганизаций.Показатели КАК Показатели
		|		ПО (Показатели.Ссылка = ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.ВидРасчета)
		|
		|СГРУППИРОВАТЬ ПО
		|	ПлановыеУдержанияРаботниковОрганизацийСрезПоследних.ФизЛицо,
		|	Показатели.НомерСтроки,
		|	Показатели.Показатель;

		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	&ОбособленноеПодразделение КАК Организация,
		|	Сотрудники.Подразделение КАК Подразделение,
		|	&ПарамДата КАК ПериодДействия,
		|	ВложенныйЗапрос.Сотрудник КАК Сотрудник,
		|	ВложенныйЗапрос.Показатель КАК Показатель,
		|	СУММА(ЕСТЬNULL(ВложенныйЗапрос.Значение, 0)) КАК Значение,
		|	ВложенныйЗапрос.Валюта КАК Валюта
		|ПОМЕСТИТЬ ВТПлановыеПоказатели
		|ИЗ
		|	(";
		Для СчПоказателей = 1 По 6 Цикл
			Запрос.Текст = Запрос.Текст + "	
			|	ВЫБРАТЬ
			|		ПлановыеНачисления.Сотрудник КАК Сотрудник,
			|		ПлановыеНачисления.Показатель" + СчПоказателей + " КАК Показатель,
			|		ПлановыеНачисления.Значение" + СчПоказателей + " КАК Значение,
			|		ПлановыеНачисления.Валюта" + СчПоказателей + " КАК Валюта
			|	ИЗ
			|		ВТПлановые КАК ПлановыеНачисления
			|	ГДЕ
			|		ПлановыеНачисления.Показатель" + СчПоказателей + " ЕСТЬ НЕ NULL 
			|		И (НЕ ПлановыеНачисления.Предопределенный" + СчПоказателей + ")";
			Если ЗначениеЗаполнено(Сотрудники) Тогда
				Запрос.Текст = Запрос.Текст + "
				|	И (ПлановыеНачисления.Показатель" + СчПоказателей + " В (&Показатели))";
			КонецЕсли;
			Если СчПоказателей < 6 Тогда
				Запрос.Текст = Запрос.Текст + "	
				|	
				|	ОБЪЕДИНИТЬ ВСЕ";
			КонецЕсли;
		КонецЦикла;
		Запрос.Текст = Запрос.Текст + "
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Сотрудники.Сотрудник,
		|		Показатели.Показатель,
		|		СУММА(Показатели.Значение),
		|		Показатели.Валюта
		|	ИЗ
		|		(";
		Для СчПоказателей = 1 По 6 Цикл
			Запрос.Текст = Запрос.Текст + "
			|		ВЫБРАТЬ
			|			ПлановыеУдержания.Сотрудник КАК Сотрудник,
			|			ПлановыеУдержания.Показатель" + СчПоказателей + " КАК Показатель,
			|			ПлановыеУдержания.Значение" + СчПоказателей + " КАК Значение,
			|			ПлановыеУдержания.Валюта" + СчПоказателей + " КАК Валюта
			|		ИЗ
			|			ВТПлановыеУд КАК ПлановыеУдержания 
			|		
			|		ГДЕ
			|			ПлановыеУдержания.Показатель" + СчПоказателей + " ЕСТЬ НЕ NULL 
			|			И (НЕ ПлановыеУдержания.Предопределенный" + СчПоказателей + ")";
			Если ЗначениеЗаполнено(Сотрудники) Тогда
				Запрос.Текст = Запрос.Текст + "
				|		И (ПлановыеУдержания.Показатель" + СчПоказателей + " В (&Показатели))";
			КонецЕсли;
			Если СчПоказателей < 6 Тогда
				Запрос.Текст = Запрос.Текст + "	
			|		
			|		ОБЪЕДИНИТЬ ВСЕ";
			КонецЕсли;
		КонецЦикла;
		Запрос.Текст = Запрос.Текст + ") КАК Показатели
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|				СписокСотрудников.Сотрудник КАК Сотрудник,
		|				СписокСотрудников.Физлицо КАК Физлицо
		|			ИЗ
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(РаботникиОсновноеМесто.Сотрудник) КАК Сотрудник,
		|					РаботникиОсновноеМесто.Сотрудник.Физлицо КАК Физлицо,
		|					1 КАК Приоритет
		|				ИЗ
		|					РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ПарамДата, Организация = &ГоловнаяОрганизация И	Сотрудник В
		|										(ВЫБРАТЬ
		|											ВТСотрудники.Сотрудник
		|												ИЗ
		|											ВТСотрудники) И Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ОсновноеМестоРаботы)) КАК РаботникиОсновноеМесто
		|				ГДЕ
		|					ВЫБОР
		|							КОГДА РаботникиОсновноеМесто.ПериодЗавершения <= &ПарамДата
		|									И РаботникиОсновноеМесто.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|								ТОГДА РаботникиОсновноеМесто.ПричинаИзмененияСостоянияЗавершения
		|							ИНАЧЕ РаботникиОсновноеМесто.ПричинаИзмененияСостояния
		|						КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|				
		|				СГРУППИРОВАТЬ ПО
		|					РаботникиОсновноеМесто.Сотрудник.Физлицо
		|				
		|				ОБЪЕДИНИТЬ
		|				
		|				ВЫБРАТЬ
		|					МАКСИМУМ(РаботникиСовместительство.Сотрудник),
		|					РаботникиСовместительство.Сотрудник.Физлицо,
		|					2
		|				ИЗ
		|					РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ПарамДата,  Организация = &ГоловнаяОрганизация И	Сотрудник В
		|										(ВЫБРАТЬ
		|											ВТСотрудники.Сотрудник
		|												ИЗ
		|											ВТСотрудники) И Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)) КАК РаботникиСовместительство
		|				ГДЕ
		|					ВЫБОР
		|							КОГДА РаботникиСовместительство.ПериодЗавершения <= &ПарамДата
		|									И РаботникиСовместительство.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|								ТОГДА РаботникиСовместительство.ПричинаИзмененияСостоянияЗавершения
		|							ИНАЧЕ РаботникиСовместительство.ПричинаИзмененияСостояния
		|						КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|				
		|				СГРУППИРОВАТЬ ПО
		|					РаботникиСовместительство.Сотрудник.Физлицо
		|				
		|				ОБЪЕДИНИТЬ
		|				
		|				ВЫБРАТЬ
		|					МАКСИМУМ(СотрудникиДУ.Ссылка),
		|					СотрудникиДУ.Физлицо,
		|					ВЫБОР
		|						КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|							ТОГДА 4
		|						ИНАЧЕ 5
		|					КОНЕЦ
		|				ИЗ
		|					Справочник.СотрудникиОрганизаций КАК СотрудникиДУ
		|				ГДЕ
		|					Организация = &ГоловнаяОрганизация И
		|						СотрудникиДУ.Ссылка В
		|								(ВЫБРАТЬ
		|									ВТСотрудники.Сотрудник
		|								ИЗ
		|									ВТСотрудники)
		|				
		|				СГРУППИРОВАТЬ ПО
		|					СотрудникиДУ.Физлицо,
		|					ВЫБОР
		|						КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|							ТОГДА 4
		|						ИНАЧЕ 5
		|					КОНЕЦ) КАК СписокСотрудников
		|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|						СписокФизическихЛиц.Физлицо КАК Физлицо,
		|						МИНИМУМ(СписокФизическихЛиц.Приоритет) КАК Приоритет
		|					ИЗ
		|						(ВЫБРАТЬ
		|							РаботникиОсновноеМесто.Сотрудник.Физлицо КАК Физлицо,
		|							1 КАК Приоритет
		|						ИЗ
		|							РегистрСведений.РаботникиОрганизаций.СрезПоследних(
		|									&ПарамДата,
		|									Организация = &ГоловнаяОрганизация
		|									И	Сотрудник В
		|										(ВЫБРАТЬ
		|											ВТСотрудники.Сотрудник
		|												ИЗ
		|											ВТСотрудники)
		|									И	Сотрудник.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|										И Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ОсновноеМестоРаботы)) КАК РаботникиОсновноеМесто
		|						ГДЕ
		|							ВЫБОР
		|									КОГДА РаботникиОсновноеМесто.ПериодЗавершения <= &ПарамДата
		|											И РаботникиОсновноеМесто.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|										ТОГДА РаботникиОсновноеМесто.ПричинаИзмененияСостоянияЗавершения
		|									ИНАЧЕ РаботникиОсновноеМесто.ПричинаИзмененияСостояния
		|								КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|						
		|						ОБЪЕДИНИТЬ
		|						
		|						ВЫБРАТЬ
		|							РаботникиСовместительство.Сотрудник.Физлицо,
		|							2
		|						ИЗ
		|							РегистрСведений.РаботникиОрганизаций.СрезПоследних(
		|									&ПарамДата,
		|									Организация = &ГоловнаяОрганизация
		|									И	Сотрудник В
		|										(ВЫБРАТЬ
		|											ВТСотрудники.Сотрудник
		|												ИЗ
		|											ВТСотрудники)
		|									И	Сотрудник.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|										И Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)) КАК РаботникиСовместительство
		|						ГДЕ
		|							ВЫБОР
		|									КОГДА РаботникиСовместительство.ПериодЗавершения <= &ПарамДата
		|											И РаботникиСовместительство.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|										ТОГДА РаботникиСовместительство.ПричинаИзмененияСостоянияЗавершения
		|									ИНАЧЕ РаботникиСовместительство.ПричинаИзмененияСостояния
		|								КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|						
		|						ОБЪЕДИНИТЬ
		|						
		|						ВЫБРАТЬ
		|							СотрудникиДУ.Физлицо,
		|							ВЫБОР
		|								КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|									ТОГДА 4
		|								ИНАЧЕ 5
		|							КОНЕЦ
		|						ИЗ
		|							Справочник.СотрудникиОрганизаций КАК СотрудникиДУ
		|						ГДЕ
		|								Организация = &ГоловнаяОрганизация И
		|								СотрудникиДУ.Ссылка В
		|									(ВЫБРАТЬ
		|										ВТСотрудники.Сотрудник
		|									ИЗ
		|										ВТСотрудники)) КАК СписокФизическихЛиц
		|					
		|					СГРУППИРОВАТЬ ПО
		|						СписокФизическихЛиц.Физлицо) КАК СписокФизическихЛиц
		|					ПО СписокСотрудников.Физлицо = СписокФизическихЛиц.Физлицо
		|						И СписокСотрудников.Приоритет = СписокФизическихЛиц.Приоритет) КАК Сотрудники
		|			ПО Показатели.Сотрудник = Сотрудники.Физлицо
		|	
		|	СГРУППИРОВАТЬ ПО
		|		Показатели.Показатель,
		|		Сотрудники.Сотрудник,
		|		Показатели.Валюта) КАК ВложенныйЗапрос
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
		|		ПО (Сотрудники.Сотрудник = ВложенныйЗапрос.Сотрудник)
		|
		|СГРУППИРОВАТЬ ПО
		|	Сотрудники.Подразделение,
		|	ВложенныйЗапрос.Сотрудник,
		|	ВложенныйЗапрос.Показатель,
		|	ВложенныйЗапрос.Валюта
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Показатель,
		|	Сотрудник,
		|	Подразделение";
		
		Запрос.Выполнить();
		
		Если ЗначениеЗаполнено(ТаблицаЗапроса) Тогда
			
			Запрос.УстановитьПараметр("ТаблицаЗапроса",ТаблицаЗапроса);
			
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Таблица.ВидПоказателя,
			|	Таблица.Показатель,
			|	Таблица.Сотрудник КАК Сотрудник
			|ПОМЕСТИТЬ ВТПоказателиИСотрудники
			|ИЗ
			|	&ТаблицаЗапроса КАК Таблица
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Сотрудник
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	&ОбособленноеПодразделение КАК Организация,
			|	ИтоговаяТаблица.Подразделение КАК Подразделение,
			|	ИтоговаяТаблица.Сотрудник КАК Сотрудник,
			|	ИтоговаяТаблица.Показатель КАК Показатель,
			|	ИтоговаяТаблица.ПериодДействия КАК ПериодДействия,
			|	ИтоговаяТаблица.Валюта КАК Валюта,
			|	СУММА(ЕСТЬNULL(ИтоговаяТаблица.ФактическоеЗначение, ИтоговаяТаблица.ПлановоеЗначение)) КАК Значение
			|ИЗ
			|	(ВЫБРАТЬ
			|		ВложеннаяТаблица.Показатель КАК Показатель,
			|		ВложеннаяТаблица.Подразделение КАК Подразделение,
			|		ВложеннаяТаблица.Сотрудник КАК Сотрудник,
			|		ВложеннаяТаблица.ПериодДействия КАК ПериодДействия,
			|		МАКСИМУМ(ВложеннаяТаблица.Валюта) КАК Валюта,
			|		МАКСИМУМ(ВложеннаяТаблица.ФактическоеЗначение) КАК ФактическоеЗначение,
			|		МАКСИМУМ(ВложеннаяТаблица.ПлановоеЗначение) КАК ПлановоеЗначение
			|	ИЗ
			|		(ВЫБРАТЬ
			|			Факт.Показатель КАК Показатель,
			|			Факт.Подразделение КАК Подразделение,
			|			Факт.Сотрудник КАК Сотрудник,
			|			Факт.ПериодДействия КАК ПериодДействия,
			|			МАКСИМУМ(Факт.Валюта) КАК Валюта,
			|			СУММА(ЕСТЬNULL(Факт.Значение, 0)) КАК ФактическоеЗначение,
			|			NULL КАК ПлановоеЗначение
			|		ИЗ
			|			(ВЫБРАТЬ
			|				ЗначенияПоказателейСхемМотивации.Показатель КАК Показатель,
			|				ВЫБОР
			|					КОГДА ЗначенияПоказателейСхемМотивации.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.ПоПодразделению)
			|						ТОГДА ВЫРАЗИТЬ(ЗначенияПоказателейСхемМотивации.Подразделение КАК Справочник.ПодразделенияОрганизаций)
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
			|				КОНЕЦ КАК Подразделение,
			|				ВЫБОР
			|					КОГДА ЗначенияПоказателейСхемМотивации.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|						ТОГДА ЗначенияПоказателейСхемМотивации.Сотрудник
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|				КОНЕЦ КАК Сотрудник,
			|				ЗначенияПоказателейСхемМотивации.ПериодДействия КАК ПериодДействия,
			|				МАКСИМУМ(ЗначенияПоказателейСхемМотивации.Валюта) КАК Валюта,
			|				СУММА(ЗначенияПоказателейСхемМотивации.Значение) КАК Значение
			|			ИЗ
			|				РегистрСведений.ЗначенияПоказателейСхемМотивации КАК ЗначенияПоказателейСхемМотивации
			|			ГДЕ
			|				ЗначенияПоказателейСхемМотивации.Организация = &ОбособленноеПодразделение
			|				И (НЕ ЗначенияПоказателейСхемМотивации.Показатель.Предопределенный)
			|				И ЗначенияПоказателейСхемМотивации.ПериодДействия = &ПарамДата
			|				И ЗначенияПоказателейСхемМотивации.Сотрудник В
			|									(ВЫБРАТЬ
			|										ВТСотрудники.Сотрудник
			|									ИЗ
			|										ВТСотрудники)
			|";
			Если ЗначениеЗаполнено(Показатели) Тогда
				Запрос.Текст = Запрос.Текст + "
			|				И (ЗначенияПоказателейСхемМотивации.Показатель В (&Показатели))";
			КонецЕсли;
			Запрос.Текст = Запрос.Текст + "
			|			
			|			СГРУППИРОВАТЬ ПО
			|				ЗначенияПоказателейСхемМотивации.Показатель,
			|				ВЫБОР
			|					КОГДА ЗначенияПоказателейСхемМотивации.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.ПоПодразделению)
			|						ТОГДА ВЫРАЗИТЬ(ЗначенияПоказателейСхемМотивации.Подразделение КАК Справочник.ПодразделенияОрганизаций)
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
			|				КОНЕЦ,
			|				ВЫБОР
			|					КОГДА ЗначенияПоказателейСхемМотивации.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|						ТОГДА ЗначенияПоказателейСхемМотивации.Сотрудник
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|				КОНЕЦ,
			|				ЗначенияПоказателейСхемМотивации.Сотрудник,
			|				ЗначенияПоказателейСхемМотивации.ПериодДействия
			|			
			|			ОБЪЕДИНИТЬ ВСЕ
			|			
			|			ВЫБРАТЬ
			|				ТаблицаЗапроса.Показатель,
			|				ВЫБОР
			|					КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.ПоПодразделению)
			|						ТОГДА ВЫРАЗИТЬ(Сотрудники.Подразделение КАК Справочник.ПодразделенияОрганизаций)
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
			|				КОНЕЦ,
			|				ВЫБОР
			|					КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|						ТОГДА ТаблицаЗапроса.Сотрудник
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|				КОНЕЦ,
			|				&ПарамДата,
			|				NULL,
			|				СУММА(0)
			|			ИЗ
			|				ВТПоказателиИСотрудники КАК ТаблицаЗапроса
			|					ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
			|					ПО (Сотрудники.Сотрудник = ТаблицаЗапроса.Сотрудник)
			|			
			|			СГРУППИРОВАТЬ ПО
			|				ВЫБОР
			|					КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.ПоПодразделению)
			|						ТОГДА ВЫРАЗИТЬ(Сотрудники.Подразделение КАК Справочник.ПодразделенияОрганизаций)
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
			|				КОНЕЦ,
			|				ВЫБОР
			|					КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|						ТОГДА ТаблицаЗапроса.Сотрудник
			|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|				КОНЕЦ,
			|				ТаблицаЗапроса.Показатель) КАК Факт
			|		
			|		СГРУППИРОВАТЬ ПО
			|			Факт.Показатель,
			|			Факт.Подразделение,
			|			Факт.Сотрудник,
			|			Факт.ПериодДействия
			|		
			|		ОБЪЕДИНИТЬ
			|		
			|		ВЫБРАТЬ
			|			ПЛАН.Показатель,
			|			ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка),
			|			ВЫБОР
			|				КОГДА ПЛАН.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|					ТОГДА ПЛАН.Сотрудник
			|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|			КОНЕЦ,
			|			ПЛАН.ПериодДействия,
			|			ВЫБОР
			|				КОГДА ПЛАН.Валюта = НЕОПРЕДЕЛЕНО
			|					ТОГДА NULL
			|				ИНАЧЕ ПЛАН.Валюта
			|			КОНЕЦ,
			|			NULL,
			|			ЕСТЬNULL(ПЛАН.Значение, 0)
			|		ИЗ
			|			ВТПлановыеПоказатели КАК ПЛАН) КАК ВложеннаяТаблица
			|	
			|	СГРУППИРОВАТЬ ПО
			|		ВложеннаяТаблица.Показатель,
			|		ВложеннаяТаблица.Подразделение,
			|		ВложеннаяТаблица.Сотрудник,
			|		ВложеннаяТаблица.ПериодДействия) КАК ИтоговаяТаблица
			|ГДЕ
			|	ИтоговаяТаблица.Показатель.ВозможностьИзменения = ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.Ежемесячно)
			|
			|СГРУППИРОВАТЬ ПО
			|	ИтоговаяТаблица.Подразделение,
			|	ИтоговаяТаблица.Сотрудник,
			|	ИтоговаяТаблица.Показатель,
			|	ИтоговаяТаблица.ПериодДействия,
			|	ИтоговаяТаблица.Валюта
			|
			|УПОРЯДОЧИТЬ ПО
			|	Подразделение,
			|	ИтоговаяТаблица.Сотрудник.Наименование,
			|	Показатель";

		Иначе
			
			Запрос.Текст =
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	Показатели.Организация КАК Организация,
			|	Показатели.Подразделение КАК Подразделение,
			|	Показатели.ПериодДействия КАК ПериодДействия,
			|	Показатели.Сотрудник КАК Сотрудник,
			|	Показатели.Показатель КАК Показатель,
			|	Показатели.Валюта,
			|	СУММА(Показатели.Значение) КАК Значение
			|ИЗ
			|	(ВЫБРАТЬ
			|		ПлановыеПоказатели.Организация КАК Организация,
			|		ПлановыеПоказатели.Подразделение КАК Подразделение,
			|		ПлановыеПоказатели.ПериодДействия КАК ПериодДействия,
			|		ПлановыеПоказатели.Сотрудник КАК Сотрудник,
			|		ПлановыеПоказатели.Показатель КАК Показатель,
			|		ПлановыеПоказатели.Значение КАК Значение,
			|		ПлановыеПоказатели.Валюта КАК Валюта
			|	ИЗ
			|		ВТПлановыеПоказатели КАК ПлановыеПоказатели
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		&ОбособленноеПодразделение,
			|		ЗначенияПоказателейСхемМотивации.Подразделение,
			|		&ПарамДата,
			|		ЗначенияПоказателейСхемМотивации.Сотрудник,
			|		ЗначенияПоказателейСхемМотивации.Показатель,
			|		ЕСТЬNULL(ЗначенияПоказателейСхемМотивации.Значение, 0),
			|		ЗначенияПоказателейСхемМотивации.Валюта
			|	ИЗ
			|		РегистрСведений.ЗначенияПоказателейСхемМотивации КАК ЗначенияПоказателейСхемМотивации
			|	ГДЕ
			|		ЗначенияПоказателейСхемМотивации.Организация = &ОбособленноеПодразделение
			|		И (НЕ ЗначенияПоказателейСхемМотивации.Показатель.Предопределенный)";
			Если ЗначениеЗаполнено(Показатели) Тогда
				Запрос.Текст = Запрос.Текст + "
			|		И ЗначенияПоказателейСхемМотивации.Показатель В(&Показатели)";
			КонецЕсли;
			Запрос.Текст = Запрос.Текст + "
			|		И ЗначенияПоказателейСхемМотивации.ПериодДействия = &ПарамДата) КАК Показатели
			|
			|ГДЕ Показатели.Показатель.ВозможностьИзменения = ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.Ежемесячно)
			|
			|СГРУППИРОВАТЬ ПО
			|	Показатели.Сотрудник,
			|	Показатели.Показатель,
			|	Показатели.Подразделение,
			|	Показатели.Валюта,
			|	Показатели.Организация,
			|	Показатели.ПериодДействия
			|
			|УПОРЯДОЧИТЬ ПО
			|	Организация,
			|	Подразделение,
			|	Сотрудник,
			|	Показатель";
		КонецЕсли;
		
	Иначе
		
		Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(ПериодДействия));
		
		Запрос.УстановитьПараметр("Сотрудники",Сотрудники);
		Запрос.УстановитьПараметр("Показатели",Показатели);
		
		ТекстЗапроса = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	Работники.ФизЛицо КАК ФизЛицо,
		|	Работники.Подразделение
		|ПОМЕСТИТЬ ВТСотрудники
		|ИЗ
		|	РегистрСведений.Работники.СрезПоследних(&ПарамДата, ) КАК Работники
		|ГДЕ
		|	Работники.ПричинаИзмененияСостояния <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	Работники.ФизЛицо,
		|	NULL
		|ИЗ
		|	РегистрСведений.Работники КАК Работники
		|ГДЕ
		|	Работники.Период > &ПарамДата
		|	И Работники.Период <= &КонецМесяца
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	Работники.ФизЛицо,
		|	NULL
		|ИЗ
		|	РегистрСведений.Работники КАК Работники
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Работники КАК ПериодыПерекрытия
		|		ПО (ПериодыПерекрытия.Период > Работники.Период)
		|ГДЕ
		|	ПериодыПерекрытия.Период ЕСТЬ NULL 
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ФизЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПоказателиНачислений.Ссылка КАК Ссылка,
		|	ПоказателиНачислений.НомерСтроки,
		|	ПоказателиНачислений.Показатель
		|ПОМЕСТИТЬ ПоказателиВидовРасчета
		|ИЗ
		|	ПланВидовРасчета.УправленческиеНачисления.Показатели КАК ПоказателиНачислений
		|ГДЕ
		|	(НЕ ПоказателиНачислений.Показатель.Предопределенный)
		|	И (НЕ ПоказателиНачислений.Показатель.ВозможностьИзменения В (ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.НеИзменяется), ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.ПустаяСсылка)))
		|	И (НЕ ПоказателиНачислений.Показатель.ТипПоказателя В (ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейСхемМотивации.ОценочнаяШкалаЧисловая), ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейСхемМотивации.ОценочнаяШкалаПроцентная), ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейСхемМотивации.ТарифныйРазряд)))
		|";
		Если ЗначениеЗаполнено(Показатели) Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|	И ПоказателиНачислений.Показатель В(&Показатели)
			|";
		КонецЕсли;		
		ТекстЗапроса = ТекстЗапроса + "
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	ПоказателиУдержаний.Ссылка,
		|	ПоказателиУдержаний.НомерСтроки,
		|	ПоказателиУдержаний.Показатель
		|ИЗ
		|	ПланВидовРасчета.УправленческиеУдержания.Показатели КАК ПоказателиУдержаний
		|ГДЕ
		|	(НЕ ПоказателиУдержаний.Показатель.Предопределенный)
		|	И (НЕ ПоказателиУдержаний.Показатель.ВозможностьИзменения В (ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.НеИзменяется), ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.ПустаяСсылка)))
		|	И (НЕ ПоказателиУдержаний.Показатель.ТипПоказателя В (ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейСхемМотивации.ОценочнаяШкалаЧисловая), ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейСхемМотивации.ОценочнаяШкалаПроцентная), ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейСхемМотивации.ТарифныйРазряд)))
		|";
		Если ЗначениеЗаполнено(Показатели) Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|	И ПоказателиУдержаний.Показатель В(&Показатели)
			|";
		КонецЕсли;		
		ТекстЗапроса = ТекстЗапроса + "
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПлановыеНачисленияРаботниковСрезПоследних.ФизЛицо КАК ФизЛицо,
		|	ПоказателиВидовРасчета.Показатель КАК Показатель,
		|	ВЫБОР
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 1
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.Показатель1Завершения
		|					ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Показатель1
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 2
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.Показатель2Завершения
		|					ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Показатель2
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 3
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.Показатель3Завершения
		|					ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Показатель3
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 4
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.Показатель4Завершения
		|					ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Показатель4
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 5
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.Показатель5Завершения
		|					ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Показатель5
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 6
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.Показатель6Завершения
		|					ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Показатель6
		|				КОНЕЦ
		|	КОНЕЦ КАК Значение,
		|	ПоказателиВидовРасчета.Показатель.Валюта КАК Валюта
		|ПОМЕСТИТЬ ПлановыеНачисленияУдержания
		|ИЗ
		|	РегистрСведений.ПлановыеНачисленияРаботников.СрезПоследних(
		|			&ПарамДата,
		|			ФизЛицо В
		|				(ВЫБРАТЬ
		|					ВТСотрудники.ФизЛицо
		|				ИЗ
		|					ВТСотрудники)) КАК ПлановыеНачисленияРаботниковСрезПоследних
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоказателиВидовРасчета КАК ПоказателиВидовРасчета
		|		ПО (ВЫБОР
		|				КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|						И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|					ТОГДА ПоказателиВидовРасчета.Ссылка = ПлановыеНачисленияРаботниковСрезПоследних.ВидРасчетаЗавершения
		|				ИНАЧЕ ПоказателиВидовРасчета.Ссылка = ПлановыеНачисленияРаботниковСрезПоследних.ВидРасчета
		|			КОНЕЦ)
		|ГДЕ
		|	ВЫБОР
		|			КОГДА ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|					И ПлановыеНачисленияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|				ТОГДА ПлановыеНачисленияРаботниковСрезПоследних.ДействиеЗавершения <> ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|			ИНАЧЕ ПлановыеНачисленияРаботниковСрезПоследних.Действие <> ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|		КОНЕЦ
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	ПлановыеУдержанияРаботниковСрезПоследних.ФизЛицо,
		|	ПоказателиВидовРасчета.Показатель,
		|	ВЫБОР
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 1
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.Показатель1Завершения
		|					ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Показатель1
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 2
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.Показатель2Завершения
		|					ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Показатель2
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 3
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.Показатель3Завершения
		|					ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Показатель3
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 4
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.Показатель4Завершения
		|					ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Показатель4
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 5
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.Показатель5Завершения
		|					ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Показатель5
		|				КОНЕЦ
		|		КОГДА ПоказателиВидовРасчета.НомерСтроки = 6
		|			ТОГДА ВЫБОР
		|					КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|							И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|						ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.Показатель6Завершения
		|					ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Показатель6
		|				КОНЕЦ
		|	КОНЕЦ,
		|	ПоказателиВидовРасчета.Показатель.Валюта
		|ИЗ
		|	РегистрСведений.ПлановыеУдержанияРаботников.СрезПоследних(
		|			&ПарамДата,
		|			ФизЛицо В
		|				(ВЫБРАТЬ
		|					ВТСотрудники.ФизЛицо
		|				ИЗ
		|					ВТСотрудники)) КАК ПлановыеУдержанияРаботниковСрезПоследних
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоказателиВидовРасчета КАК ПоказателиВидовРасчета
		|		ПО (ПоказателиВидовРасчета.Ссылка = ПлановыеУдержанияРаботниковСрезПоследних.ВидРасчета)
		|ГДЕ
		|	ВЫБОР
		|			КОГДА ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|					И ПлановыеУдержанияРаботниковСрезПоследних.ПериодЗавершения <= &ПарамДата
		|				ТОГДА ПлановыеУдержанияРаботниковСрезПоследних.ДействиеЗавершения <> ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|			ИНАЧЕ ПлановыеУдержанияРаботниковСрезПоследних.Действие <> ЗНАЧЕНИЕ(Перечисление.ВидыДействияСНачислением.Прекратить)
		|		КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Сотрудники.Подразделение КАК Подразделение,
		|	&ПарамДата КАК ПериодДействия,
		|	ПлановыеНачисленияУдержания.ФизЛицо КАК ФизЛицо,
		|	ПлановыеНачисленияУдержания.Показатель КАК Показатель,
		|	ПлановыеНачисленияУдержания.Значение КАК Значение,
		|	ПлановыеНачисленияУдержания.Валюта КАК Валюта
		|ПОМЕСТИТЬ ВТПлановыеПоказатели
		|ИЗ
		|	ПлановыеНачисленияУдержания КАК ПлановыеНачисленияУдержания
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
		|		ПО (Сотрудники.ФизЛицо = ПлановыеНачисленияУдержания.ФизЛицо)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Показатель,
		|	ФизЛицо,
		|	Подразделение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РаботникиОрганизацийСрезПоследних.Сотрудник КАК Сотрудник,
		|	РаботникиОрганизацийСрезПоследних.Сотрудник.Физлицо КАК Физлицо,
		|	РаботникиОрганизацийСрезПоследних.Сотрудник.ВидДоговора КАК ВидДоговора,
		|	РаботникиОрганизацийСрезПоследних.Сотрудник.ВидЗанятости КАК ВидЗанятости
		|ПОМЕСТИТЬ РаботникиОрганизацийСрезПоследних
		|ИЗ
		|	РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ПарамДата, 
		|";
		Если ЗначениеЗаполнено(Сотрудники) Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|	Сотрудник В (&Сотрудники)
			|";
		КонецЕсли;		
		ТекстЗапроса = ТекстЗапроса + ") КАК РаботникиОрганизацийСрезПоследних
		|ГДЕ
		|	ВЫБОР
		|			КОГДА РаботникиОрганизацийСрезПоследних.ПериодЗавершения <= &ПарамДата
		|					И РаботникиОрганизацийСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА РаботникиОрганизацийСрезПоследних.ПричинаИзмененияСостоянияЗавершения
		|			ИНАЧЕ РаботникиОрганизацийСрезПоследних.ПричинаИзмененияСостояния
		|		КОНЕЦ <> ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиОрганизаций.Ссылка,
		|	СотрудникиОрганизаций.Физлицо,
		|	СотрудникиОрганизаций.ВидДоговора
		|ПОМЕСТИТЬ СправочникСотрудники
		|ИЗ
		|	Справочник.СотрудникиОрганизаций КАК СотрудникиОрганизаций
		|";
		Если ЗначениеЗаполнено(Сотрудники) Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|ГДЕ
			|	СотрудникиОрганизаций.Ссылка В(&Сотрудники)
			|";
		КонецЕсли;		
		ТекстЗапроса = ТекстЗапроса + "
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СписокФизическихЛиц.Физлицо КАК Физлицо,
		|	МИНИМУМ(СписокФизическихЛиц.Приоритет) КАК Приоритет
		|ПОМЕСТИТЬ СписокФизическихЛиц
		|ИЗ
		|	(ВЫБРАТЬ
		|		РаботникиОрганизацийСрезПоследних.Физлицо КАК Физлицо,
		|		1 КАК Приоритет
		|	ИЗ
		|		РаботникиОрганизацийСрезПоследних КАК РаботникиОрганизацийСрезПоследних
		|	ГДЕ
		|		РаботникиОрганизацийСрезПоследних.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|		И РаботникиОрганизацийСрезПоследних.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ОсновноеМестоРаботы)
		|	
		|	ОБЪЕДИНИТЬ
		|	
		|	ВЫБРАТЬ
		|		РаботникиОрганизацийСрезПоследних.Физлицо,
		|		2
		|	ИЗ
		|		РаботникиОрганизацийСрезПоследних КАК РаботникиОрганизацийСрезПоследних
		|	ГДЕ
		|		РаботникиОрганизацийСрезПоследних.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|		И РаботникиОрганизацийСрезПоследних.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|	
		|	ОБЪЕДИНИТЬ
		|	
		|	ВЫБРАТЬ
		|		СотрудникиДУ.Физлицо,
		|		ВЫБОР
		|			КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ДоговорУправленческий)
		|				ТОГДА 3
		|			КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|				ТОГДА 4
		|			ИНАЧЕ 5
		|		КОНЕЦ
		|	ИЗ
		|		СправочникСотрудники КАК СотрудникиДУ) КАК СписокФизическихЛиц
		|
		|СГРУППИРОВАТЬ ПО
		|	СписокФизическихЛиц.Физлицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МАКСИМУМ(РаботникиОсновноеМесто.Сотрудник) КАК Сотрудник,
		|	РаботникиОсновноеМесто.Физлицо КАК Физлицо,
		|	1 КАК Приоритет
		|ПОМЕСТИТЬ СписокСотрудников
		|ИЗ
		|	РаботникиОрганизацийСрезПоследних КАК РаботникиОсновноеМесто
		|ГДЕ
		|	РаботникиОсновноеМесто.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ОсновноеМестоРаботы)
		|
		|СГРУППИРОВАТЬ ПО
		|	РаботникиОсновноеМесто.Физлицо
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	МАКСИМУМ(РаботникиСовместительство.Сотрудник),
		|	РаботникиСовместительство.Физлицо,
		|	2
		|ИЗ
		|	РаботникиОрганизацийСрезПоследних КАК РаботникиСовместительство
		|ГДЕ
		|	РаботникиСовместительство.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
		|
		|СГРУППИРОВАТЬ ПО
		|	РаботникиСовместительство.Физлицо
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	МАКСИМУМ(СотрудникиДУ.Ссылка),
		|	СотрудникиДУ.Физлицо,
		|	ВЫБОР
		|		КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ДоговорУправленческий)
		|			ТОГДА 3
		|		КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|			ТОГДА 4
		|		ИНАЧЕ 5
		|	КОНЕЦ
		|ИЗ
		|	СправочникСотрудники КАК СотрудникиДУ
		|
		|СГРУППИРОВАТЬ ПО
		|	СотрудникиДУ.Физлицо,
		|	ВЫБОР
		|		КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ДоговорУправленческий)
		|			ТОГДА 3
		|		КОГДА СотрудникиДУ.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровСФизЛицами.ТрудовойДоговор)
		|			ТОГДА 4
		|		ИНАЧЕ 5
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СписокСотрудников.Сотрудник КАК Сотрудник,
		|	СписокСотрудников.Физлицо КАК Физлицо
		|ПОМЕСТИТЬ СотрудникиФизлица
		|ИЗ
		|	СписокСотрудников КАК СписокСотрудников
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокФизическихЛиц КАК СписокФизическихЛиц
		|		ПО СписокСотрудников.Физлицо = СписокФизическихЛиц.Физлицо
		|			И СписокСотрудников.Приоритет = СписокФизическихЛиц.Приоритет
		|
		|ИНДЕКСИРОВАТЬ ПО 
		|	СписокСотрудников.Сотрудник,
		|	СписокСотрудников.Физлицо
		|";
		
		Запрос.Текст = ТекстЗапроса;
		Запрос.Выполнить();
		
		Если ИзДокумента Тогда
			
			Запрос.УстановитьПараметр("ТаблицаЗапроса", ТаблицаЗапроса);
			
			ТекстЗапроса = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Таблица.ВидПоказателя,
			|	Таблица.Показатель,
			|	Таблица.Сотрудник
			|ПОМЕСТИТЬ ВТПоказателиИСотрудники
			|ИЗ
			|	&ТаблицаЗапроса КАК Таблица
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Таблица.Сотрудник
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ЗначенияПоказателейСхемМотивации.Показатель КАК Показатель,
			|	ВЫБОР
			|		КОГДА ЗначенияПоказателейСхемМотивации.Подразделение = НЕОПРЕДЕЛЕНО
			|			ТОГДА ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка)
			|		ИНАЧЕ ЗначенияПоказателейСхемМотивации.Подразделение
			|	КОНЕЦ КАК Подразделение,
			|	ВЫБОР
			|		КОГДА ЗначенияПоказателейСхемМотивации.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|			ТОГДА ЗначенияПоказателейСхемМотивации.Сотрудник
			|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|	КОНЕЦ КАК Сотрудник,
			|	ЗначенияПоказателейСхемМотивации.ПериодДействия КАК ПериодДействия,
			|	ВЫБОР
			|		КОГДА ЗначенияПоказателейСхемМотивации." + ОбщегоНазначения.ВалютаПоказателяИмяПоляЗапроса() + " = ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)
			|			ТОГДА ЗначенияПоказателейСхемМотивации.Показатель.Валюта
			|		ИНАЧЕ ЗначенияПоказателейСхемМотивации.Валюта
			|	КОНЕЦ КАК Валюта,
			|	ЗначенияПоказателейСхемМотивации.Значение КАК Значение
			|ПОМЕСТИТЬ Факт
			|ИЗ
			|	РегистрСведений.ЗначенияПоказателейСхемМотивации КАК ЗначенияПоказателейСхемМотивации
			|ГДЕ
			|	ЗначенияПоказателейСхемМотивации.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			|	И (НЕ ЗначенияПоказателейСхемМотивации.Показатель.Предопределенный)
			|	И ЗначенияПоказателейСхемМотивации.ПериодДействия = &ПарамДата
			|";
			Если ЗначениеЗаполнено(Показатели) Тогда
				ТекстЗапроса = ТекстЗапроса + "
				|	И ЗначенияПоказателейСхемМотивации.Показатель В(&Показатели)
				|";
			КонецЕсли;
			ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТаблицаЗапроса.Показатель,
			|	ВЫБОР
			|		КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.ПоПодразделению)
			|			ТОГДА ВЫРАЗИТЬ(Сотрудники.Подразделение КАК Справочник.Подразделения)
			|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка)
			|	КОНЕЦ,
			|	ВЫБОР
			|		КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|			ТОГДА ТаблицаЗапроса.Сотрудник
			|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|	КОНЕЦ,
			|	&ПарамДата,
			|	ТаблицаЗапроса.Показатель.Валюта,
			|	СУММА(0)
			|ИЗ
			|	ВТПоказателиИСотрудники КАК ТаблицаЗапроса
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
			|		ПО (Сотрудники.ФизЛицо = ТаблицаЗапроса.Сотрудник.Физлицо)
			|
			|СГРУППИРОВАТЬ ПО
			|	ВЫБОР
			|		КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.ПоПодразделению)
			|			ТОГДА ВЫРАЗИТЬ(Сотрудники.Подразделение КАК Справочник.Подразделения)
			|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка)
			|	КОНЕЦ,
			|	ВЫБОР
			|		КОГДА ТаблицаЗапроса.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|			ТОГДА ТаблицаЗапроса.Сотрудник
			|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|	КОНЕЦ,
			|	ТаблицаЗапроса.Показатель
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	Факт.Показатель КАК Показатель,
			|	Факт.Подразделение КАК Подразделение,
			|	Факт.Сотрудник.Физлицо КАК Сотрудник,
			|	Факт.ПериодДействия КАК ПериодДействия,
			|	МАКСИМУМ(Факт.Валюта) КАК Валюта,
			|	СУММА(ЕСТЬNULL(Факт.Значение, 0)) КАК ФактическоеЗначение,
			|	NULL КАК ПлановоеЗначение
			|ПОМЕСТИТЬ ВложеннаяТаблица
			|ИЗ
			|	Факт КАК Факт
			|
			|СГРУППИРОВАТЬ ПО
			|	Факт.Показатель,
			|	Факт.Подразделение,
			|	Факт.Сотрудник,
			|	Факт.ПериодДействия,
			|	Факт.Сотрудник.Физлицо
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ
			|	ПЛАН.Показатель,
			|	ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка),
			|	ВЫБОР
			|		КОГДА ПЛАН.Показатель.ВидПоказателя = ЗНАЧЕНИЕ(Перечисление.ВидыПоказателейСхемМотивации.Индивидуальный)
			|			ТОГДА ПЛАН.ФизЛицо
			|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СотрудникиОрганизаций.ПустаяСсылка)
			|	КОНЕЦ,
			|	ПЛАН.ПериодДействия,
			|	ВЫБОР
			|		КОГДА ПЛАН.Валюта = НЕОПРЕДЕЛЕНО
			|			ТОГДА NULL
			|		ИНАЧЕ ПЛАН.Валюта
			|	КОНЕЦ,
			|	NULL,
			|	ЕСТЬNULL(ПЛАН.Значение, 0)
			|ИЗ
			|	ВТПлановыеПоказатели КАК ПЛАН
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВложеннаяТаблица.Показатель КАК Показатель,
			|	ВложеннаяТаблица.Подразделение КАК Подразделение,
			|	ВложеннаяТаблица.Сотрудник КАК Сотрудник,
			|	ВложеннаяТаблица.ПериодДействия КАК ПериодДействия,
			|	МАКСИМУМ(ВложеннаяТаблица.Валюта) КАК Валюта,
			|	МАКСИМУМ(ВложеннаяТаблица.ФактическоеЗначение) КАК ФактическоеЗначение,
			|	МАКСИМУМ(ВложеннаяТаблица.ПлановоеЗначение) КАК ПлановоеЗначение
			|ПОМЕСТИТЬ ИтоговаяТаблица
			|ИЗ
			|	ВложеннаяТаблица КАК ВложеннаяТаблица
			|
			|СГРУППИРОВАТЬ ПО
			|	ВложеннаяТаблица.Подразделение,
			|	ВложеннаяТаблица.Сотрудник,
			|	ВложеннаяТаблица.Показатель,
			|	ВложеннаяТаблица.ПериодДействия
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ИтоговаяТаблица.Подразделение КАК Подразделение,
			|	Сотрудники.Сотрудник КАК Сотрудник,
			|	ИтоговаяТаблица.Показатель КАК Показатель,
			|	ИтоговаяТаблица.ПериодДействия КАК ПериодДействия,
			|	ИтоговаяТаблица.Валюта КАК Валюта,
			|	СУММА(ЕСТЬNULL(ИтоговаяТаблица.ФактическоеЗначение, ИтоговаяТаблица.ПлановоеЗначение)) КАК Значение
			|ИЗ
			|	ИтоговаяТаблица КАК ИтоговаяТаблица
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СотрудникиФизлица КАК Сотрудники
			|		ПО ИтоговаяТаблица.Сотрудник = Сотрудники.Физлицо
			|ГДЕ
			|	ИтоговаяТаблица.Показатель.ВозможностьИзменения = ЗНАЧЕНИЕ(Перечисление.ИзменениеПоказателейСхемМотивации.Ежемесячно)
			|
			|СГРУППИРОВАТЬ ПО
			|	ИтоговаяТаблица.Подразделение,
			|	Сотрудники.Сотрудник,
			|	ИтоговаяТаблица.Показатель,
			|	ИтоговаяТаблица.ПериодДействия,
			|	ИтоговаяТаблица.Валюта
			|
			|УПОРЯДОЧИТЬ ПО
			|	Подразделение,
			|	Сотрудники.Сотрудник.Наименование,
			|	Показатель";
			
			Запрос.Текст = ТекстЗапроса;
			
		Иначе
			
			ТекстЗапроса = 
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	Показатели.Подразделение КАК Подразделение,
			|	Показатели.ПериодДействия КАК ПериодДействия,
			|	Показатели.Сотрудник КАК Сотрудник,
			|	Показатели.Показатель КАК Показатель,
			|	Показатели.Валюта,
			|	СУММА(Показатели.Значение) КАК Значение
			|ИЗ
			|	(ВЫБРАТЬ
			|		ПлановыеПоказатели.Подразделение КАК Подразделение,
			|		ПлановыеПоказатели.ПериодДействия КАК ПериодДействия,
			|		Сотрудники.Сотрудник КАК Сотрудник,
			|		ПлановыеПоказатели.Показатель КАК Показатель,
			|		ПлановыеПоказатели.Значение КАК Значение,
			|		ПлановыеПоказатели.Валюта КАК Валюта
			|	ИЗ
			|		ВТПлановыеПоказатели КАК ПлановыеПоказатели
			|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ СотрудникиФизлица КАК Сотрудники
			|			ПО ПлановыеПоказатели.Физлицо = Сотрудники.Физлицо
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ЗначенияПоказателейСхемМотивации.Подразделение,
			|		&ПарамДата,
			|		ЗначенияПоказателейСхемМотивации.Сотрудник,
			|		ЗначенияПоказателейСхемМотивации.Показатель,
			|		ЕСТЬNULL(ЗначенияПоказателейСхемМотивации.Значение, 0),
			|		ЗначенияПоказателейСхемМотивации.Валюта
			|	ИЗ
			|		РегистрСведений.ЗначенияПоказателейСхемМотивации КАК ЗначенияПоказателейСхемМотивации
			|	ГДЕ
			|		ЗначенияПоказателейСхемМотивации.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			|		И (НЕ ЗначенияПоказателейСхемМотивации.Показатель.Предопределенный)
			|		И ЗначенияПоказателейСхемМотивации.ПериодДействия = &ПарамДата) КАК Показатели
			|";
			Если ЗначениеЗаполнено(Показатели) Тогда
				ТекстЗапроса = ТекстЗапроса + "
				|	И ЗначенияПоказателейСхемМотивации.Показатель В(&Показатели)
				|";
			КонецЕсли;
			ТекстЗапроса = ТекстЗапроса + "
			|
			|СГРУППИРОВАТЬ ПО
			|	Показатели.Подразделение,
			|	Показатели.Сотрудник,
			|	Показатели.Показатель,
			|	Показатели.Валюта,
			|	Показатели.ПериодДействия
			|
			|УПОРЯДОЧИТЬ ПО
			|	Подразделение,
			|	Сотрудник,
			|	Показатель";
			
			Запрос.Текст = ТекстЗапроса;
		
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат Запрос.Выполнить();
	
КонецФункции

Процедура ЗаписатьИтоговыеЗаписи(Показатель, Организация, ПериодДействия)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("парамПериодРегистрации", ПериодДействия);
	Запрос.УстановитьПараметр("парамПоказатель", Показатель);
	Запрос.УстановитьПараметр("Организация", Организация);
	
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ПоказателиСхемМотивации.СуммируемыйПоказатель КАК СуммируемыйПоказатель,
	|	ПоказателиСхемМотивации.СпособРасчетаСуммы,
	|	ПоказателиСхемМотивации.Ссылка КАК Показатель
	|ПОМЕСТИТЬ ВТПоказатели
	|ИЗ
	|	Справочник.ПоказателиСхемМотивации КАК ПоказателиСхемМотивации
	|ГДЕ
	|	ПоказателиСхемМотивации.СуммируемыйПоказатель В(&парамПоказатель)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СуммируемыйПоказатель
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Показатели.Показатель КАК Показатель,
	|	ЕСТЬNULL(ИтогПоСотрудникам.Значение, 0) КАК ЗначениеИтогаПоСотрудникам,
	|	ИтогПоОрганизациям.Организация,
	|	ЕСТЬNULL(ИтогПоОрганизациям.Значение, 0) КАК ЗначениеИтогаПоОрганизациям,
	|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК Подразделение
	|ИЗ
	|	ВТПоказатели КАК Показатели
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ЗначенияПоказателейСхемМотивации.Показатель КАК Показатель,
	|			ЗначенияПоказателейСхемМотивации.Организация КАК Организация,
	|			СУММА(ЗначенияПоказателейСхемМотивации.Значение) КАК Значение
	|		ИЗ
	|			РегистрСведений.ЗначенияПоказателейСхемМотивации КАК ЗначенияПоказателейСхемМотивации
	|		ГДЕ
	|			ЗначенияПоказателейСхемМотивации.Показатель В
	|					(ВЫБРАТЬ
	|						ВТПоказатели.СуммируемыйПоказатель
	|					ИЗ
	|						ВТПоказатели КАК ВТПоказатели
	|					ГДЕ
	|						ВТПоказатели.СпособРасчетаСуммы = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаСуммыПоказателей.ПоОрганизации))
	|			И ЗначенияПоказателейСхемМотивации.ПериодДействия >= НАЧАЛОПЕРИОДА(&парамПериодРегистрации, МЕСЯЦ)
	|			И ЗначенияПоказателейСхемМотивации.ПериодДействия <= КОНЕЦПЕРИОДА(&парамПериодРегистрации, МЕСЯЦ)
	|			И ЗначенияПоказателейСхемМотивации.Организация = &Организация
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ЗначенияПоказателейСхемМотивации.Организация,
	|			ЗначенияПоказателейСхемМотивации.Показатель) КАК ИтогПоОрганизациям
	|		ПО Показатели.СуммируемыйПоказатель = ИтогПоОрганизациям.Показатель
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ЗначенияПоказателейСхемМотивации.Показатель КАК Показатель,
	|			СУММА(ЗначенияПоказателейСхемМотивации.Значение) КАК Значение
	|		ИЗ
	|			РегистрСведений.ЗначенияПоказателейСхемМотивации КАК ЗначенияПоказателейСхемМотивации
	|		ГДЕ
	|			ЗначенияПоказателейСхемМотивации.Показатель В
	|					(ВЫБРАТЬ
	|						ВТПоказатели.СуммируемыйПоказатель
	|					ИЗ
	|						ВТПоказатели КАК ВТПоказатели
	|					ГДЕ
	|						ВТПоказатели.СпособРасчетаСуммы = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаСуммыПоказателей.ПоВсемСотрудникам))
	|			И ЗначенияПоказателейСхемМотивации.ПериодДействия >= НАЧАЛОПЕРИОДА(&парамПериодРегистрации, МЕСЯЦ)
	|			И ЗначенияПоказателейСхемМотивации.ПериодДействия <= КОНЕЦПЕРИОДА(&парамПериодРегистрации, МЕСЯЦ)
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ЗначенияПоказателейСхемМотивации.Показатель) КАК ИтогПоСотрудникам
	|		ПО Показатели.СуммируемыйПоказатель = ИтогПоСотрудникам.Показатель";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		ИтоговаяЗапись = РегистрыСведений.ЗначенияПоказателейСхемМотивации.СоздатьМенеджерЗаписи();
		ИтоговаяЗапись.Показатель = Выборка.Показатель;
		ИтоговаяЗапись.ПериодДействия = ПериодДействия;
		Если ЗначениеЗаполнено(Выборка.ЗначениеИтогаПоСотрудникам) Тогда
			
			ИтоговаяЗапись.Значение = Выборка.ЗначениеИтогаПоСотрудникам;
			ИтоговаяЗапись.Подразделение = Выборка.Подразделение;
			
		Иначе
			
			ИтоговаяЗапись.Подразделение = Выборка.Подразделение;
			ИтоговаяЗапись.Организация = Организация;
			ИтоговаяЗапись.Значение = Выборка.ЗначениеИтогаПоОрганизациям;
			
		КонецЕсли;
		ИтоговаяЗапись.Записать();
	КонецЦикла;
	
КонецПроцедуры //ЗаписатьИтоговыеЗаписи

Процедура ЗаписатьИтоговыеЗаписиПериодическихПоказателей(Показатель, Организация, Период)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("парамПериод", Период);
	Запрос.УстановитьПараметр("парамПоказатель", Показатель);
	Запрос.УстановитьПараметр("Организация", Организация);
	
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ПоказателиСхемМотивации.СуммируемыйПоказатель КАК СуммируемыйПоказатель,
	|	ПоказателиСхемМотивации.СпособРасчетаСуммы,
	|	ПоказателиСхемМотивации.Ссылка КАК Показатель
	|ПОМЕСТИТЬ ВТПоказатели
	|ИЗ
	|	Справочник.ПоказателиСхемМотивации КАК ПоказателиСхемМотивации
	|ГДЕ
	|	ПоказателиСхемМотивации.СуммируемыйПоказатель В(&парамПоказатель)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СуммируемыйПоказатель
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Показатели.Показатель КАК Показатель,
	|	ЕСТЬNULL(ИтогПоСотрудникам.Значение, 0) КАК ЗначениеИтогаПоСотрудникам,
	|	ИтогПоОрганизациям.Организация,
	|	ЕСТЬNULL(ИтогПоОрганизациям.Значение, 0) КАК ЗначениеИтогаПоОрганизациям,
	|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК Подразделение
	|ИЗ
	|	ВТПоказатели КАК Показатели
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Показатель КАК Показатель,
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Организация КАК Организация,
	|			СУММА(ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Значение) КАК Значение
	|		ИЗ
	|			РегистрСведений.ПериодическиеЗначенияПоказателейСхемМотивации.СрезПоследних(
	|					&парамПериод,
	|					Организация = &Организация
	|						И Показатель В
	|							(ВЫБРАТЬ
	|								ВТПоказатели.СуммируемыйПоказатель
	|							ИЗ
	|								ВТПоказатели КАК ВТПоказатели
	|							ГДЕ
	|								ВТПоказатели.СпособРасчетаСуммы = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаСуммыПоказателей.ПоОрганизации))) КАК ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних
	|		ГДЕ
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Показатель В
	|					(ВЫБРАТЬ
	|						ВТПоказатели.СуммируемыйПоказатель
	|					ИЗ
	|						ВТПоказатели КАК ВТПоказатели
	|					ГДЕ
	|						ВТПоказатели.СпособРасчетаСуммы = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаСуммыПоказателей.ПоОрганизации))
	|			И ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Организация = &Организация
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Организация,
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Показатель) КАК ИтогПоОрганизациям
	|		ПО Показатели.СуммируемыйПоказатель = ИтогПоОрганизациям.Показатель
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Показатель КАК Показатель,
	|			СУММА(ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Значение) КАК Значение
	|		ИЗ
	|			РегистрСведений.ПериодическиеЗначенияПоказателейСхемМотивации.СрезПоследних(
	|					&парамПериод,
	|					Показатель В
	|						(ВЫБРАТЬ
	|							ВТПоказатели.СуммируемыйПоказатель
	|						ИЗ
	|							ВТПоказатели КАК ВТПоказатели
	|						ГДЕ
	|							ВТПоказатели.СпособРасчетаСуммы = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаСуммыПоказателей.ПоВсемСотрудникам))) КАК ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ПериодическиеЗначенияПоказателейСхемМотивацииСрезПоследних.Показатель) КАК ИтогПоСотрудникам
	|		ПО Показатели.СуммируемыйПоказатель = ИтогПоСотрудникам.Показатель";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		ИтоговаяЗапись = РегистрыСведений.ПериодическиеЗначенияПоказателейСхемМотивации.СоздатьМенеджерЗаписи();
		ИтоговаяЗапись.Период = Период;
		ИтоговаяЗапись.Показатель = Выборка.Показатель;
		Если ЗначениеЗаполнено(Выборка.ЗначениеИтогаПоСотрудникам) Тогда
			
			ИтоговаяЗапись.Значение = Выборка.ЗначениеИтогаПоСотрудникам;
			
		Иначе
			
			ИтоговаяЗапись.Подразделение	= Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
			ИтоговаяЗапись.Организация		= Организация;
			ИтоговаяЗапись.Значение			= Выборка.ЗначениеИтогаПоОрганизациям;
			
		КонецЕсли;
		ИтоговаяЗапись.Записать();
	КонецЦикла;
	
КонецПроцедуры //ЗаписатьИтоговыеЗаписи

Процедура ПриЗаписиПериодическихПоказателей(Отбор, Отказ, Замещение) Экспорт
	
	Показатель		= Отбор.Показатель.Значение;
	Если ЗначениеЗаполнено(Показатель) Тогда
		Если Показатель.ТипПоказателя <> Перечисления.ТипыПоказателейСхемМотивации.СуммаПоказателя Тогда
			Организация = Отбор.Организация.Значение;
			Период	= Отбор.Период.Значение;
			
			ЗаписатьИтоговыеЗаписиПериодическихПоказателей(Показатель, Организация, Период);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(Отбор, Отказ, Замещение) Экспорт
	
	Показатель		= Отбор.Показатель.Значение;
	Если ЗначениеЗаполнено(Показатель) Тогда
		Если Показатель.ТипПоказателя <> Перечисления.ТипыПоказателейСхемМотивации.СуммаПоказателя Тогда
			Организация = Отбор.Организация.Значение;
			ПериодДействия	= Отбор.ПериодДействия.Значение;
			
			ЗаписатьИтоговыеЗаписи(Показатель, Организация, ПериодДействия);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Функция ВидимостьВалютыУстановлена(КолонкаВалюта, мРежимВводаПоказателей) Экспорт
	
	Если мРежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоЦентрамОтветственности Тогда
		КолонкаВалюта.Видимость = глЗначениеПеременной("глЕстьВалютныеПоказатели");
		Возврат Истина;
	Иначе	
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции

Функция ВидимостьВалютыПоДополнительномуУсловию() Экспорт
	
	Возврат глЗначениеПеременной("глЕстьВалютныеПоказатели");

КонецФункции

Функция ОткрытьФормуВыбораСотрудникаПоДополнительномуУсловию(Элемент, СтандартнаяОбработка, РегистрСведенийМенеджерЗаписи, РежимВводаПоказателей) Экспорт
	
	Если РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоЦентрамОтветственности Тогда
		ПроцедурыУправленияПерсоналомПереопределяемый.ОткрытьФормуВыбораСотрудника(Элемент, Элемент.Значение, Истина, РегистрСведенийМенеджерЗаписи.ПериодДействия);
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;

КонецФункции // ОткрытьФормуВыбораСотрудникаПоДополнительномуУсловию
	
#Если ТолстыйКлиентОбычноеПриложение Тогда

Функция ПодобратьСотрудникаПоДополнительномуУсловию(Элемент, Текст, ТекстАвтоПодбора, СтандартнаяОбработка, РежимВводаПоказателей) Экспорт
	
	Если РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоЦентрамОтветственности Тогда
		ТекстАвтоПодбора = ПроцедурыУправленияПерсоналомДополнительный.ПодобратьФИОСотрудника(СтандартнаяОбработка, "Работники", Текст);
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции // ПодобратьСотрудникаПоДополнительномуУсловию

Функция ПодобратьСписокСотрудниковПоДополнительномуУсловию(Элемент, Текст, Значение, СтандартнаяОбработка, РежимВводаПоказателей) Экспорт
	
	Если РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоЦентрамОтветственности Тогда
		Значение = ПроцедурыУправленияПерсоналомДополнительный.ПодобратьСписокСотрудников(СтандартнаяОбработка, "Работники", Текст, Элемент.Значение);
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции // ПодобратьСписокСотрудниковПоДополнительномуУсловию
	
////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ФОРМЫ СПИСКА

// Процедура - обработчик события "ПередОткрытиемФормыСписка" формы.
//
Процедура ПередОткрытиемФормыСписка(Отказ, СтандартнаяОбработка, мРежимВводаПоказателей) Экспорт
	
	мРежимВводаПоказателей = ВосстановитьЗначение("РежимВводаПоказателей");

КонецПроцедуры // ПередОткрытиемФормыСписка

// Процедура - обработчик события "ПриОткрытииФормыСписка" формы.
//
Процедура ПриОткрытииФормыСписка(Форма, мРежимВводаПоказателей, мОрганизация, ДополнительныеДействия) Экспорт
	
	//добавим подменю управления режимом ввода показателей
	ИспользоватьУправленческийУчетЗарплаты = глЗначениеПеременной("глИспользоватьУправленческийУчетЗарплаты");
	Если ИспользоватьУправленческийУчетЗарплаты Тогда
		
		ЭлементыФормы = Форма.ЭлементыФормы;
		
		КнопкиКоманднойПанели = ЭлементыФормы.ДействияФормы.Кнопки;
		МестоВставки = КнопкиКоманднойПанели.Индекс(КнопкиКоманднойПанели.Найти("ДействиеСправка"));
		
		ПодменюПорядокФормированияСМ = КнопкиКоманднойПанели.Вставить(МестоВставки, "ПорядокФормированияСМ", ТипКнопкиКоманднойПанели.Подменю, "Режим формирования схем мотивации");
		ПодменюПорядокФормированияСМ.Кнопки.Добавить("ПоОрганизациям", 	ТипКнопкиКоманднойПанели.Действие, "По структуре юридических лиц", 	ДополнительныеДействия);
		ПодменюПорядокФормированияСМ.Кнопки.Добавить("ПоЦФО", 			ТипКнопкиКоманднойПанели.Действие, "По центрам ответственности", 	ДополнительныеДействия);
		
		КнопкиКоманднойПанели.Вставить(МестоВставки + 1, "Разделитель15", ТипКнопкиКоманднойПанели.Разделитель); 
		
		Если мРежимВводаПоказателей = Неопределено ИЛИ мРежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоСтруктуреЮридическихЛиц Тогда
			ЗначенияПоказателейСхемМотивацииДополнительный.ПереключитьРежимВводаПоказателейПоОрганизациям(мРежимВводаПоказателей, мОрганизация, Форма, Форма.РегистрСведенийСписок.Отбор);
		Иначе
			ЗначенияПоказателейСхемМотивацииДополнительный.ПереключитьРежимВводаПоказателейПоЦФО(мРежимВводаПоказателей, мОрганизация, Форма, Форма.РегистрСведенийСписок.Отбор);
		КонецЕсли;
		
		ПодменюПорядокФормированияСМ.Кнопки.ПоЦФО.Пометка = НЕ мРежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоСтруктуреЮридическихЛиц;
		ПодменюПорядокФормированияСМ.Кнопки.ПоОрганизациям.Пометка = мРежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоСтруктуреЮридическихЛиц;		
		
	Иначе
		ЗначенияПоказателейСхемМотивацииДополнительный.ПереключитьРежимВводаПоказателейПоОрганизациям(мРежимВводаПоказателей, мОрганизация, Форма, Форма.РегистрСведенийСписок.Отбор);
	КонецЕсли;
	
КонецПроцедуры // ПриОткрытииФормыСписка

// Процедура - обработчик события "ПриЗакрытии" формы.
//
Процедура ПриЗакрытииФормыСписка(мРежимВводаПоказателей) Экспорт
	
	СохранитьЗначение("РежимВводаПоказателей", мРежимВводаПоказателей);
	
КонецПроцедуры // ПриЗакрытии

Процедура ВыполнитьДополнительныеДействия(Кнопка, мРежимВводаПоказателей, мОрганизация, Форма, Отбор) Экспорт
	
	Если Кнопка.Имя = "ПоОрганизациям" Тогда
		ЗначенияПоказателейСхемМотивацииДополнительный.ПереключитьРежимВводаПоказателейПоОрганизациям(мРежимВводаПоказателей, мОрганизация, Форма, Отбор);
	ИначеЕсли Кнопка.Имя = "ПоЦФО" Тогда
		ЗначенияПоказателейСхемМотивацииДополнительный.ПереключитьРежимВводаПоказателейПоЦФО(мРежимВводаПоказателей, мОрганизация, Форма, Отбор);
	КонецЕсли;
	
КонецПроцедуры

Функция ВыполняетсяДополнительноеУсловие() Экспорт
	
	Возврат Истина
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ФОРМЫ ЗАПИСИ


Процедура ПриОткрытииФормыЗаписи(Форма) Экспорт

	// определяем режим ввода показателей
	РежимВводаПоказателей = Форма.РежимВводаПоказателей;
	Если РежимВводаПоказателей = Неопределено Тогда
		Если ЗначениеЗаполнено(Форма.Организация) Тогда
			РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоСтруктуреЮридическихЛиц;
		Иначе
			РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоЦентрамОтветственности;
		КонецЕсли;
		Форма.РежимВводаПоказателей = РежимВводаПоказателей;
	КонецЕсли;
	
	// ограничиваем тип реквизита Подразделение
	Если Форма.Подразделение = Неопределено Тогда
		ОписаниеТипа = Новый ОписаниеТипов(?(РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоСтруктуреЮридическихЛиц, "СправочникСсылка.ПодразделенияОрганизаций", "СправочникСсылка.Подразделения"));
		Форма.Подразделение = ОписаниеТипа.ПривестиЗначение(Форма.Подразделение);
	КонецЕсли;
	
КонецПроцедуры

Процедура УправлениеЭлементамиФормыДополнительно(ЭтаФорма) Экспорт
	
	РежимВводаПоЦФО = ЗначенияПоказателейСхемМотивацииДополнительный.РежимВводаПоЦФО(ЭтаФорма.РежимВводаПоказателей);
	
	Если РежимВводаПоЦФО Тогда
		ЭтаФорма.ЭлементыФормы.ПанельОрганизация.Свертка	= РежимСверткиЭлементаУправления.Верх;
	Иначе
		ЭтаФорма.ЭлементыФормы.ПанельОрганизация.Свертка	= РежимСверткиЭлементаУправления.Нет;
	КонецЕсли;
	
КонецПроцедуры

Функция РежимВводаПоОрганизациям(мРежимВводаПоказателей) Экспорт
	
	Возврат НЕ ЗначенияПоказателейСхемМотивацииДополнительный.РежимВводаПоЦФО(мРежимВводаПоказателей);
	
КонецФункции

 #КонецЕсли

Функция ПустоеПодразделение(Форма) Экспорт
	
	Возврат ?(Форма.РежимВводаПоказателей = Перечисления.ВидыОрганизационнойСтруктурыПредприятия.ПоСтруктуреЮридическихЛиц, Справочники.ПодразделенияОрганизаций.ПустаяСсылка(), Справочники.Подразделения.ПустаяСсылка());
	
КонецФункции