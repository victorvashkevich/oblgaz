<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="">2.01</ВерсияФормата>
	<Ид>bc30dd93-6c74-4974-899d-1625f60bf1ca0008</Ид>
	<Наименование>Мегаполис для выгрузки заданий --&gt; ЗУП (для обмена заданиями)</Наименование>
	<ДатаВремяСоздания>2019-08-06T09:43:32</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.3.89.2" СинонимКонфигурации="Управление производственным предприятием, редакция 1.3">УправлениеПроизводственнымПредприятием</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="2.5.63.16" СинонимКонфигурации="Зарплата и Управление Персоналом для Беларуси, редакция 2.5">ЗарплатаИУправлениеПерсоналомДляБеларуси</Приемник>
	<Параметры>
		<Параметр Имя="Организация                                       " Наименование="Организация" ИспользуетсяПриЗагрузке="false" УстанавливатьВДиалоге="false" ТипЗначения="СправочникСсылка.Организации" ПередаватьПараметрПриВыгрузке="false"/>
	</Параметры>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Документы</Код>
			<Наименование>Документы</Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>ВыполнениеЗадания</Код>
				<Наименование>Документ: Заявки от абонентов на выполнение работ</Наименование>
				<Порядок>50</Порядок>
				<ПослеЗагрузки>Объект.Организация = ПараметрыОбъекта["ОрганизацияИзМегаполиса"].Организация;
Объект.ПодразделениеОрганизации = ПараметрыОбъекта["ПодразделениеИзМегаполиса"].ПодразделениеОрганизации;

//Для Каждого Стр Из Объект.РаботникиОрганизации Цикл
//	
//	ВидРаботыОтбор=Новый Структура("ВидРаботы",Стр.ВидРаботы);
//	СведенияОВидеРабот=РегистрыСведений.СведенияОВидахРабот.ПолучитьПоследнее(Объект.Дата,ВидРаботыОтбор);
//	ПродолжительностьРаботы=СведенияОВидеРабот.НормаВремени;
//	Стр.ПродолжительностьРаботы = ПродолжительностьРаботы*Стр.Количество;	
//	
//КонецЦикла;

//из-за параметров придется извращаться, сделаем по-другому

Если Объект.РаботникиОрганизации.Количество() &gt; 0 ТОгда
	
	НомерСтроки = 0;

	Для каждого СтрокаПараметров Из ПараметрыОбъекта["РаботникиОрганизацииТабличнаяЧасть"] Цикл
	
		Стр = Объект.РаботникиОрганизации.Получить(НомерСтроки);
		НомерСтроки = НомерСтроки + 1;
	
		ВидРаботыОтбор=Новый Структура("ВидРаботы",Стр.ВидРаботы);
		СведенияОВидеРабот=РегистрыСведений.СведенияОВидахРабот.ПолучитьПоследнее(Объект.Дата,ВидРаботыОтбор);
		ПродолжительностьРаботы=СведенияОВидеРабот.НормаВремени;
		Стр.ПродолжительностьРаботы = ПродолжительностьРаботы*Стр.Количество;	
	
		НеНачислятьАбоненту = СтрокаПараметров.НеНачислятьАбоненту;
	
		Если НеНачислятьАбоненту ТОгда
		
			Стр.Стоимость = СведенияОВидеРабот.СтоимостьПоПрейскуранту;
			Стр.Сумма =  Стр.Стоимость * Стр.Количество;
		
		КонецЕсли;
	
	КонецЦикла;
	
КонецЕсли;

//Если заполнены исполнители и виды работ, т.е. было ручное распределение в зарплате, то распределим согласно коэффициентов исполнителя
Если (Объект.Исполнители.Количество() &gt; 0) и (Объект.ВидыРабот.Количество() &gt; 0) и (Объект.Исполнители.Итог("Коэффициент") = 1) ТОгда
	
	СтруктураПоиска= НОвый Структура;
		
	Для Каждого ТекСотр Из Объект.Исполнители Цикл
			
		Для Каждого ТекРаб Из Объект.ВидыРабот Цикл
			
			СтруктураПоиска.Вставить("Сотрудник",ТекСотр.Сотрудник);
			СтруктураПоиска.Вставить("ВидРаботы",ТекРаб.ВидРаботы);
				
			НайденныеСтроки = Объект.РаботникиОрганизации.НайтиСтроки(СтруктураПоиска);
			
			Если НайденныеСтроки.Количество()&lt;&gt;0 ТОгда
				
				Для Каждого Стр Из НайденныеСтроки Цикл 
					Стр.ПродолжительностьРаботы = ТекРаб.ПродолжительностьРаботы * ТекСотр.Коэффициент;
					Стр.Количество = ТекСотр.Коэффициент * ТекРаб.Количество;
					Стр.Сумма =  Стр.Стоимость * Стр.Количество;
				КонецЦикла;	
				
			КонецЕсли;
			
		КонецЦикла;		
			
	КонецЦикла;
КонецЕсли;</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если НомерВариантаПоиска = 1 Тогда
	
	СсылкаПоGUID = Документы.ВыполнениеЗадания.ПолучитьСсылку(Новый УникальныйИдентификатор(ПараметрыОбъекта["УникальныйИдентификатор"]));
	
	Попытка
		ПроверяемаяСсылка = СсылкаПоGUID.ПолучитьОбъект().Ссылка;
		СсылкаНаОбъект =  СсылкаПоGUID;
	Исключение
		СтрокаИменСвойствПоиска = "Дата,НомерМегаполис";
	КонецПопытки;		
	
Иначе
	
	СтрокаИменСвойствПоиска = "Дата,НомерМегаполис";
	
КонецЕсли;</ПоследовательностьПолейПоиска>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>ДокументСсылка.MGS_ZAKAZ</Источник>
				<Приемник>ДокументСсылка.ВыполнениеЗадания</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование> --&gt; Дата</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<ПередВыгрузкой>Значение = ВходящиеДанные.Дата</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование> --&gt; НомерМегаполис</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="НомерМегаполис" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СокрЛП(ВходящиеДанные.Номер)</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование> --&gt; ПометкаУдаления</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = ВходящиеДанные.ПометкаУдаления</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование> --&gt; Проведен</Наименование>
						<Порядок>200</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = ВходящиеДанные.Проведен</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>5</Код>
						<Наименование> --&gt; РаботникиОрганизации</Наименование>
						<Порядок>250</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="РаботникиОрганизации" Вид="ТабличнаяЧасть"/>
						<ПередОбработкойВыгрузки>КоллекцияОбъектов = ВходящиеДанные.ТабЧасть</ПередОбработкойВыгрузки>
						<Свойство>
							<Код>6</Код>
							<Наименование> --&gt; Сотрудник</Наименование>
							<Порядок>50</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Сотрудник" Вид="Реквизит" Тип="СправочникСсылка.СотрудникиОрганизаций"/>
							<КодПравилаКонвертации>СотрудникиОрганизаций                             </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.Сотрудник</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>7</Код>
							<Наименование> --&gt; ФизЛицо</Наименование>
							<Порядок>100</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ФизЛицо" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
							<КодПравилаКонвертации>ФизическиеЛица                                    </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.ФизЛицо</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>8</Код>
							<Наименование> --&gt; ВидРаботы</Наименование>
							<Порядок>150</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВидРаботы" Вид="Реквизит" Тип="СправочникСсылка.ВидыРабот"/>
							<КодПравилаКонвертации>ВидыРабот                                         </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.ВидРаботы</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>9</Код>
							<Наименование> --&gt; Количество</Наименование>
							<Порядок>200</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.Количество</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>10</Код>
							<Наименование> --&gt; Стоимость</Наименование>
							<Порядок>250</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Стоимость" Вид="Реквизит" Тип="Число"/>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.Стоимость;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>11</Код>
							<Наименование> --&gt; Сумма</Наименование>
							<Порядок>300</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.Сумма</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>12</Код>
							<Наименование> --&gt; АдресВыполненияРаботы</Наименование>
							<Порядок>350</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="АдресВыполненияРаботы" Вид="Реквизит" Тип="Строка"/>
							<ПередВыгрузкой>Значение = СокрЛП(ОбъектКоллекции.АдресВыполненияРаботы)</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>18</Код>
							<Наименование> --&gt; ВариантПриемаДенежныхСредств</Наименование>
							<Порядок>400</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ВариантПриемаДенежныхСредств" Вид="Реквизит" Тип="ПеречислениеСсылка.ВариантыПриемаДенежныхСредств"/>
							<ПередВыгрузкой>Если ОбъектКоллекции.Наличные ТОГДА
	Значение="Наличные";
Иначе
	Значение="ПоследующаяОплатаПоСчету";
КонецЕсли;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>19</Код>
							<Наименование> --&gt;</Наименование>
							<Порядок>450</Порядок>
							<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="" Вид=""/>
							<ИмяПараметраДляПередачи>НеНачислятьАбоненту</ИмяПараметраДляПередачи>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.НеНачислятьАбоненту</ПередВыгрузкой>
						</Свойство>
					</Группа>
					<Свойство>
						<Код>13</Код>
						<Наименование> --&gt; Мастер</Наименование>
						<Порядок>300</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Мастер" Вид="Реквизит" Тип="СправочникСсылка.СотрудникиОрганизаций"/>
						<ПередВыгрузкой>Значение = ВходящиеДанные.Мастер</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование> --&gt; ДатаЗадания</Наименование>
						<Порядок>350</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ДатаЗадания" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование> --&gt; </Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<КодПравилаКонвертации>ПодразделенияОрганизаций                          </КодПравилаКонвертации>
						<ИмяПараметраДляПередачи>ПодразделениеИзМегаполиса</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ВходящиеДанные.ПодразделениеОрганизации</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>16</Код>
						<Наименование> --&gt; </Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
						<ИмяПараметраДляПередачи>ОрганизацияИзМегаполиса</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ВходящиеДанные.Организация</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование> --&gt; Комментарий</Наименование>
						<Порядок>450</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = "&lt;БРЕМИН&gt; "+Строка(ВходящиеДанные.ПодразделениеОрганизации)</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>20</Код>
						<Наименование> --&gt;</Наименование>
						<Порядок>500</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>УникальныйИдентификатор</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = ВходящиеДанные.УникальныйИдентификатор</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>100</Порядок>
			<Правило>
				<Код>СотрудникиОрганизаций</Код>
				<Наименование>Справочник: Сотрудники</Наименование>
				<Порядок>50</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.СотрудникиОрганизаций</Источник>
				<Приемник>СправочникСсылка.СотрудникиОрганизаций</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>17</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>850</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>33</Код>
						<Наименование>Физлицо --&gt; Физлицо</Наименование>
						<Порядок>1650</Порядок>
						<Источник Имя="Физлицо" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
						<Приемник Имя="Физлицо" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/>
						<КодПравилаКонвертации>ФизическиеЛица                                    </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>34</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>1700</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ФизическиеЛица</Код>
				<Наименование>Справочник: Физические лица</Наименование>
				<Порядок>450</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.ФизическиеЛица</Источник>
				<Приемник>СправочникСсылка.ФизическиеЛица</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>9</ПриводитьКДлине>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Родитель --&gt; Родитель</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.ФизическиеЛица"/>
						<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.ФизическиеЛица"/>
						<КодПравилаКонвертации>ФизическиеЛица                                    </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>4</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ВидыРабот</Код>
				<Наименование>Справочник: Номенклатура</Наименование>
				<Порядок>500</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Номенклатура</Источник>
				<Приемник>СправочникСсылка.ВидыРабот</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Артикул --&gt; КодПоПрейскуранту</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Артикул" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодПоПрейскуранту" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СокрЛП(Источник.Артикул)</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Родитель --&gt; Родитель</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Номенклатура"/>
						<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.ВидыРабот"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>5</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ПодразделенияОрганизаций</Код>
				<Наименование>Справочник: Организации</Наименование>
				<Порядок>550</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.ПодразделенияОрганизаций</Источник>
				<Приемник>СправочникСсылка.MGS_ПодразделенияОрганизаций</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Организации</Код>
				<Наименование>Справочник: Организации</Наименование>
				<Порядок>600</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Организации</Источник>
				<Приемник>СправочникСсылка.MGS_Организации</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Документы</Код>
			<Наименование>Документы</Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="false">
				<Код>MGS_ZAKAZ</Код>
				<Наименование>MGS_ZAKAZ</Наименование>
				<Порядок>50</Порядок>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.MGS_ZAKAZ</ОбъектВыборки>
				<ПередОбработкойПравила>//Выборка = Документы.MGS_ZAKAZ.Выбрать(ДатаНачала,ДатаОкончания);
Запрос = Новый Запрос;

Запрос.УстановитьПараметр("НачПериода",ДатаНачала);
Запрос.УстановитьПараметр("Организация",Параметры.Организация);
Запрос.УстановитьПараметр("КонПериода",ДатаОкончания);
Запрос.УстановитьПараметр("Выполнен",Справочники.vog_СтатусыДоговора.Выполнен);

Запрос.Текст = 

"ВЫБРАТЬ РАЗРЕШЕННЫЕ
|	MGS_ZAKAZSBUTZAKAZ.Ссылка КАК Ссылка,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.ID_MENEDGER_ZAKAZ КАК ID_MENEDGER_ZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.ID_BAZA_ZAKAZ КАК ID_BAZA_ZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.ID_MY_WORK_WORK_ZAKAZ КАК ID_MY_WORK_WORK_ZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.FULL_ADRESS_ZAKAZ КАК FULL_ADRESS_ZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.Подразделение_ZAKAZ КАК Подразделение_ZAKAZ,
//|	MGS_ZAKAZSBUTZAKAZ.Ссылка.Дата КАК Дата,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.TIME_FAKT_ZAKAZ КАК Дата,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.Номер КАК Номер,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.BRG_Наличными КАК Наличные,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.Проведен КАК Проведен,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.ПометкаУдаления КАК ПометкаУдаления,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.ID_MY_WORK_WORK_ZAKAZ.Физлицо КАК ФизЛицо,
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.Выполнил2_ZAKAZ КАК Выполнил2_ZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.KOLVO_SBUTZAKAZ КАК KOLVO_SBUTZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.ID_KATALOG_SBUTZAKAZ КАК ID_KATALOG_SBUTZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.ID_KATALOG_SBUTZAKAZ.Артикул КАК Артикул,
|	MGS_ZAKAZSBUTZAKAZ.CENA_SBUTZAKAZ КАК CENA_SBUTZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.BRG_НеНачислять КАК НеНачислятьАбоненту,
|	MGS_ZAKAZSBUTZAKAZ.SUMMA_SBUTZAKAZ КАК SUMMA_SBUTZAKAZ,
|	MGS_ZAKAZSBUTZAKAZ.НомерСтроки КАК НомерСтроки
|ИЗ
|	Документ.MGS_ZAKAZ.SBUTZAKAZ КАК MGS_ZAKAZSBUTZAKAZ
|ГДЕ
|	MGS_ZAKAZSBUTZAKAZ.Ссылка.ID_BAZA_ZAKAZ = &amp;Организация
|	И MGS_ZAKAZSBUTZAKAZ.Ссылка.ID_TYPE_ZAKAZ = &amp;Выполнен
|	И НЕ MGS_ZAKAZSBUTZAKAZ.Ссылка.ВыполненоСтороннейОрганизацией_ZAKAZ
|	И MGS_ZAKAZSBUTZAKAZ.Ссылка.Проведен
//берем дату выполнения заявки, а не дату формирования 28.04.18
//|	И MGS_ZAKAZSBUTZAKAZ.Ссылка.Дата МЕЖДУ &amp;НачПериода И &amp;КонПериода
|	И MGS_ZAKAZSBUTZAKAZ.Ссылка.TIME_FAKT_ZAKAZ МЕЖДУ &amp;НачПериода И &amp;КонПериода
|
|УПОРЯДОЧИТЬ ПО
|	Ссылка,
|	НомерСтроки";
	
ТабЧасть = Новый ТаблицаЗначений;

ТабЧасть.Колонки.Добавить("Сотрудник");
ТабЧасть.Колонки.Добавить("ФизЛицо");
ТабЧасть.Колонки.Добавить("ВидРаботы");
ТабЧасть.Колонки.Добавить("ПродолжительностьРаботы");
ТабЧасть.Колонки.Добавить("АдресВыполненияРаботы");
ТабЧасть.Колонки.Добавить("НомерАкта");
ТабЧасть.Колонки.Добавить("Сумма");
ТабЧасть.Колонки.Добавить("ВариантПриемаДенежныхСредств");
ТабЧасть.Колонки.Добавить("Стоимость");
ТабЧасть.Колонки.Добавить("Количество");
ТабЧасть.Колонки.Добавить("Коэффициент");
ТабЧасть.Колонки.Добавить("Наличные");
ТабЧасть.Колонки.Добавить("НеНачислятьАбоненту");

ДанныеВыгрузки = Новый Структура;

Выборка = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
//Пока Выборка.Следующий() Цикл
Пока Выборка.СледующийПоЗначениюПоля("Ссылка") Цикл
	
	//Если Выборка.ID_BAZA_ZAKAZ&lt;&gt;Параметры.Организация Тогда
	//	Продолжить;
	//КонецЕсли;
	//
	//Если не Выборка.Проведен ТОгда
	//	Продолжить;
	//КонецЕсли;
	//
	//Если Выборка.ID_TYPE_ZAKAZ&lt;&gt;Справочники.vog_СтатусыДоговора.Выполнен ТОгда
	//	Продолжить;
	//КонецЕсли;
	
	ТабЧасть.Очистить();
	
	//Для каждого Стр Из Выборка.SBUTZAKAZ Цикл
	Пока Выборка.СледующийПоЗначениюПоля("НомерСтроки") Цикл
		
		//Если Не ЗначениеЗаполнено(Стр.ID_KATALOG_SBUTZAKAZ) ТОгда 
		Если Не ЗначениеЗаполнено(Выборка.ID_KATALOG_SBUTZAKAZ) ТОгда 
			
			Продолжить;
			
		КонецЕсли;
		
		Если СокрЛП(Выборка.Артикул)="" ТОгда 
			
			Продолжить;
			
		КонецЕсли;
		
		//06.08.2019
		Если СокрЛП(Выборка.Артикул)="МАТЕРИАЛЫ" ТОгда 
			
			Продолжить;
			
		КонецЕсли;

		//пропускаем транспортные расходы. Можно потом выделить в параметры, на пожар так
		Если (Лев(СокрЛП(Выборка.Артикул),3)="9-2") или (Лев(СокрЛП(Выборка.Артикул),3)="9-3") или (Лев(СокрЛП(Выборка.Артикул),3)="9-5") или (Лев(СокрЛП(Выборка.Артикул),3)="9-7") ТОгда 
			
			Продолжить;
			
		КонецЕсли;
		
		Коэффициент = ?(ЗначениеЗаполнено(Выборка.Выполнил2_ZAKAZ),2,1);
		
		НоваяСтрока = ТабЧасть.Добавить();
		НоваяСтрока.Сотрудник = Выборка.ID_MY_WORK_WORK_ZAKAZ;
		НоваяСтрока.ФизЛицо = Выборка.ID_MY_WORK_WORK_ZAKAZ.Физлицо;
		//НоваяСтрока.Стоимость = Стр.CENA_SBUTZAKAZ;
		//НоваяСтрока.Количество = Стр.KOLVO_SBUTZAKAZ / Коэффициент;
		//НоваяСтрока.ВидРаботы = Стр.ID_KATALOG_SBUTZAKAZ;
		НоваяСтрока.Стоимость = Выборка.CENA_SBUTZAKAZ;
		НоваяСтрока.Количество = Выборка.KOLVO_SBUTZAKAZ / Коэффициент;
		НоваяСтрока.ВидРаботы = Выборка.ID_KATALOG_SBUTZAKAZ;
		НоваяСтрока.Наличные = Выборка.Наличные;
		НоваяСтрока.НеНачислятьАбоненту = Выборка.НеНачислятьАбоненту;

		//НоваяСтрока.Сумма = Стр.SUMMA_SBUTZAKAZ;
		НоваяСтрока.Сумма = Окр(НоваяСтрока.Количество * НоваяСтрока.Стоимость,2);
		СтоимостьБезКоэффициента = Окр(Выборка.KOLVO_SBUTZAKAZ * НоваяСтрока.Стоимость,2);
		НоваяСтрока.АдресВыполненияРаботы = СокрЛП(Выборка.FULL_ADRESS_ZAKAZ);
		
		Если ЗначениеЗаполнено(Выборка.Выполнил2_ZAKAZ) ТОгда
			
			СуммаПред  = НоваяСтрока.Сумма;
			
			НоваяСтрока = ТабЧасть.Добавить();
			НоваяСтрока.Сотрудник = Выборка.Выполнил2_ZAKAZ;
			НоваяСтрока.ФизЛицо = Выборка.Выполнил2_ZAKAZ.Физлицо;
			//НоваяСтрока.Стоимость = Стр.CENA_SBUTZAKAZ;
			//НоваяСтрока.Количество = Стр.KOLVO_SBUTZAKAZ / Коэффициент;
			//НоваяСтрока.ВидРаботы = Стр.ID_KATALOG_SBUTZAKAZ;			
			//НоваяСтрока.Сумма = Стр.SUMMA_SBUTZAKAZ - СуммаПред;
			НоваяСтрока.Стоимость = Выборка.CENA_SBUTZAKAZ;
			НоваяСтрока.Количество = Выборка.KOLVO_SBUTZAKAZ / Коэффициент;
			НоваяСтрока.ВидРаботы = Выборка.ID_KATALOG_SBUTZAKAZ;
			НоваяСтрока.Наличные = Выборка.Наличные;
			НоваяСтрока.НеНачислятьАбоненту = Выборка.НеНачислятьАбоненту;
			//НоваяСтрока.Сумма = Выборка.SUMMA_SBUTZAKAZ - СуммаПред;
			НоваяСтрока.Сумма = СтоимостьБезКоэффициента - СуммаПред;
			НоваяСтрока.АдресВыполненияРаботы = СокрЛП(Выборка.FULL_ADRESS_ZAKAZ);
						
			
		КонецЕсли;
		
		
	КонецЦикла;		
	
	
	ДанныеВыгрузки.Вставить("Дата",Выборка.Дата);
	ДанныеВыгрузки.Вставить("Организация",Выборка.ID_BAZA_ZAKAZ);
	ДанныеВыгрузки.Вставить("ПодразделениеОрганизации",Выборка.Подразделение_ZAKAZ);
	ДанныеВыгрузки.Вставить("ДатаЗадания",Выборка.Дата);
	ДанныеВыгрузки.Вставить("Проведен",Выборка.Проведен);
	ДанныеВыгрузки.Вставить("ПометкаУдаления",Выборка.ПометкаУдаления);
	ДанныеВыгрузки.Вставить("Номер",Выборка.Номер);
	ДанныеВыгрузки.Вставить("Мастер",Выборка.ID_MENEDGER_ZAKAZ);
	ДанныеВыгрузки.Вставить("УникальныйИдентификатор",Строка(Выборка.Ссылка.УникальныйИдентификатор()));
	ДанныеВыгрузки.Вставить("ТабЧасть",ТабЧасть);
	
	
	ВыгрузитьПоПравилу(,,ДанныеВыгрузки,,"ВыполнениеЗадания");
	
КонецЦикла;</ПередОбработкойПравила>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы/>
	<Запросы/>
</ПравилаОбмена>