
Процедура ОбработкаЗагрузки(КлючОбъекта, КлючНастроек, Настройки, ОписаниеНастроек, Пользователь)
	
	ТЗ = "ВЫБРАТЬ
	     |	ВариантыОтчетов.Наименование,
	     |	ВариантыОтчетов.ХранилищеЗначений
	     |ИЗ
	     |	Справочник.ВариантыОтчетов КАК ВариантыОтчетов
	     |ГДЕ
	     |	ВариантыОтчетов.КлючОбъекта = &КлючОбъекта
	     |	И ВариантыОтчетов.КлючВарианта = &КлючВарианта";
		 
	Запрос = Новый Запрос(ТЗ);
	Запрос.УстановитьПараметр("КлючОбъекта", КлючОбъекта);
	Запрос.УстановитьПараметр("КлючВарианта", КлючНастроек);
	
	УстановитьПривилегированныйРежим(истина);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ОписаниеНастроек.Представление = Выборка.Наименование;
		Настройки = Выборка.ХранилищеЗначений.Получить();
	КонецЕсли;
 	УстановитьПривилегированныйРежим(ложь);

КонецПроцедуры

Процедура ОбработкаСохранения(КлючОбъекта, КлючНастроек, Настройка, ОписаниеНастроек, Пользователь)
	
	ТЗ = "ВЫБРАТЬ
	     |	ВариантыОтчетов.Ссылка
	     |ИЗ
	     |	Справочник.ВариантыОтчетов КАК ВариантыОтчетов
	     |ГДЕ
	     |	ВариантыОтчетов.КлючОбъекта = &КлючОбъекта
	     |	И ВариантыОтчетов.КлючВарианта = &КлючВарианта";
		 
	Запрос = Новый Запрос(ТЗ);
	Запрос.УстановитьПараметр("КлючОбъекта",  КлючОбъекта);
	Запрос.УстановитьПараметр("КлючВарианта", КлючНастроек);
 	УстановитьПривилегированныйРежим(истина);
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		НастройкаОбъект = Выборка.Ссылка.ПолучитьОбъект();
		НастройкаОбъект.ХранилищеЗначений = Новый ХранилищеЗначения(Настройка, Новый СжатиеДанных());
		Если ОписаниеНастроек <> Неопределено Тогда
			НастройкаОбъект.Наименование = ОписаниеНастроек.Представление;
		КонецЕсли;
		НастройкаОбъект.Записать();
	КонецЕсли;
 	УстановитьПривилегированныйРежим(ложь);
	
КонецПроцедуры

Процедура ОбработкаПолученияОписания(КлючОбъекта, КлючНастроек, ОписаниеНастроек, Пользователь)
	
	ОписаниеНастроек.КлючОбъекта  = КлючОбъекта;
	ОписаниеНастроек.КлючНастроек = КлючНастроек;
	
	ТЗ = "ВЫБРАТЬ
	     |	ВариантыОтчетов.Ссылка,
		 |	ВариантыОтчетов.Наименование
	     |ИЗ
	     |	Справочник.ВариантыОтчетов КАК ВариантыОтчетов
	     |ГДЕ
	     |	ВариантыОтчетов.КлючОбъекта = &КлючОбъекта
	     |	И ВариантыОтчетов.КлючВарианта = &КлючВарианта";
		 
	Запрос = Новый Запрос(ТЗ);
	Запрос.УстановитьПараметр("КлючОбъекта",  КлючОбъекта);
	Запрос.УстановитьПараметр("КлючВарианта", КлючНастроек);
 	УстановитьПривилегированныйРежим(истина);
	Выборка = Запрос.Выполнить().Выбрать();
 	УстановитьПривилегированныйРежим(ложь);
	
	Если Выборка.Следующий() Тогда
		ВариантОтчета = Выборка.Ссылка;
		Если Не ВариантОтчета.Пустая() Тогда
			ОписаниеНастроек.Представление = Выборка.Наименование;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаУстановкиОписания(КлючОбъекта, КлючНастроек, ОписаниеНастроек, Пользователь)
	ТЗ = "ВЫБРАТЬ
	     |	ВариантыОтчетов.Ссылка
	     |ИЗ
	     |	Справочник.ВариантыОтчетов КАК ВариантыОтчетов
	     |ГДЕ
	     |	ВариантыОтчетов.КлючОбъекта = &КлючОбъекта
	     |	И ВариантыОтчетов.КлючВарианта = &КлючВарианта";
		 
	Запрос = Новый Запрос(ТЗ);
	Запрос.УстановитьПараметр("КлючОбъекта",  КлючОбъекта);
	Запрос.УстановитьПараметр("КлючВарианта", КлючНастроек);
 	УстановитьПривилегированныйРежим(истина);
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		Ссылка = Выборка.Ссылка;
		Если Не Ссылка.Пустая() Тогда
			НастройкаОбъект = Ссылка.ПолучитьОбъект();
			НастройкаОбъект.Наименование = ОписаниеНастроек.Представление;
			НастройкаОбъект.Записать();
		КонецЕсли;
	КонецЕсли;
 	УстановитьПривилегированныйРежим(ложь);
	
КонецПроцедуры


