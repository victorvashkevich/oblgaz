Перем мПодразделенияДокументы Экспорт;  // соответствие подразделений и документов перерасчета
Перем мРаботникиДокументы Экспорт; // соответствие работников и документов перерасчета


Функция СформироватьЗапрос(Организации = Неопределено, ТекущийПериодРегистрации = Неопределено, СписокПомеченныхДокументов = Неопределено, МаксимальноеКоличествоСобытий = 0) Экспорт
	
	Если Не ЗначениеЗаполнено(ТекущийПериодРегистрации) Тогда
		ТекущийПериодРегистрации = НачалоМесяца(ОбщегоНазначения.ПолучитьРабочуюДату())
	КонецЕсли;	
	
	ТекстПервыхЗаписей = ?(МаксимальноеКоличествоСобытий = 0, "", " ПЕРВЫЕ " + МаксимальноеКоличествоСобытий);
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ТекущийПериод",				ТекущийПериодРегистрации);
	Запрос.УстановитьПараметр("СписокПомеченныхДокументов",	СписокПомеченныхДокументов);
	Запрос.УстановитьПараметр("ПоВсемОрганизациям",			Не ЗначениеЗаполнено(Организации));
	Запрос.УстановитьПараметр("Организация",				Организации);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",		Неопределено);
	Если ЗначениеЗаполнено(Организации) Тогда
		Запрос.Текст =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	ВЫБОР
		|		КОГДА Организации.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|			ТОГДА Организации.Ссылка
		|		ИНАЧЕ Организации.ГоловнаяОрганизация
		|	КОНЕЦ КАК ГоловнаяОрганизация
		|ИЗ
		|	Справочник.Организации КАК Организации
		|ГДЕ
		|	Организации.Ссылка В(&Организация)";
		Запрос.УстановитьПараметр("ГоловнаяОрганизация", Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ГоловнаяОрганизация"));
	КонецЕсли;
	
	// документы к перерасчету без отборов по периоду начисления и организации
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПерерасчетОсновныхНачислений.ОбъектПерерасчета КАК Документ
	|ПОМЕСТИТЬ ВТДокументыКПерерасчету
	|ИЗ
	|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ПерерасчетОсновныхНачислений КАК ПерерасчетОсновныхНачислений
	|ГДЕ
	|	(&ПоВсемОрганизациям
	|			ИЛИ ПерерасчетОсновныхНачислений.Организация В (&ГоловнаяОрганизация))
	|	И (НЕ ПерерасчетОсновныхНачислений.ОбъектПерерасчета ССЫЛКА Документ.Сторнирование)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПерерасчетДополнительныхНачислений.ОбъектПерерасчета
	|ИЗ
	|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.ПерерасчетДополнительныхНачислений КАК ПерерасчетДополнительныхНачислений
	|ГДЕ
	|	(&ПоВсемОрганизациям
	|			ИЛИ ПерерасчетДополнительныхНачислений.Организация В (&ГоловнаяОрганизация))
	|	И (НЕ ПерерасчетДополнительныхНачислений.ОбъектПерерасчета ССЫЛКА Документ.Сторнирование)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПерерасчетСреднегоЗаработка.ОбъектПерерасчета
	|ИЗ
	|	РегистрРасчета.РасчетСреднегоЗаработка.ПерерасчетСреднегоЗаработка КАК ПерерасчетСреднегоЗаработка
	|ГДЕ
	|	(&ПоВсемОрганизациям
	|			ИЛИ ПерерасчетСреднегоЗаработка.Организация В (&ГоловнаяОрганизация))
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаполнениеПлановыхНачислений.ОбъектЗаполнения
	|ИЗ
	|	РегистрСведений.ЗаполнениеПлановыхНачислений КАК ЗаполнениеПлановыхНачислений
	|ГДЕ
	|	ЗаполнениеПлановыхНачислений.ПериодРегистрации < &ТекущийПериод
	|	И (&ПоВсемОрганизациям
	|			ИЛИ ЗаполнениеПлановыхНачислений.ОбособленноеПодразделение В (&Организация))
	|	И ЗаполнениеПлановыхНачислений.ПериодРегистрации <> ДАТАВРЕМЯ(1, 1, 1)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	
	Если Запрос.Выполнить().Выгрузить()[0].Количество = 0 Тогда // перерассчитывать нечего - остальные запросы исполнять не будем
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ПустаяТаблица.Документ,
		|	ДАТАВРЕМЯ(1, 1, 1) КАК ПериодРегистрации,
		|	"""" КАК НаименованиеОрганизации,
		|	"""" КАК Наименование,
		|	"""" КАК Ссылка,
		|	"""" КАК Организация
		|ИЗ
		|	ВТДокументыКПерерасчету КАК ПустаяТаблица";
		
		Возврат Запрос.Выполнить()
	
	КонецЕсли;
	
	// однострочные документы к перерасчету предыдущих периодов с отбором по организации без исправленных документов (которых пересчитывать уже нельзя)
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	НачислениеОтпускаРаботникамОрганизаций.Ссылка КАК Документ,
	|	НачислениеОтпускаРаботникамОрганизаций.ПериодРегистрации,
	|	НачислениеОтпускаРаботникамОрганизаций.Организация
	|ПОМЕСТИТЬ ВТНачислениеОтпуска
	|ИЗ
	|	Документ.НачислениеОтпускаРаботникамОрганизаций КАК НачислениеОтпускаРаботникамОрганизаций
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.НачислениеОтпускаРаботникамОрганизаций КАК Исправления
	|		ПО НачислениеОтпускаРаботникамОрганизаций.Ссылка = Исправления.ПерерассчитываемыйДокумент
	|ГДЕ
	|	НачислениеОтпускаРаботникамОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ НачислениеОтпускаРаботникамОрганизаций.Организация В (&Организация))
	|	И НачислениеОтпускаРаботникамОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|	И Исправления.Ссылка ЕСТЬ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	НачислениеПоБольничномуЛисту.Ссылка КАК Документ,
	|	НачислениеПоБольничномуЛисту.ПериодРегистрации,
	|	НачислениеПоБольничномуЛисту.Организация
	|ПОМЕСТИТЬ ВТНачислениеПоБольничномуЛисту
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту КАК НачислениеПоБольничномуЛисту
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.НачислениеПоБольничномуЛисту КАК Исправления
	|		ПО НачислениеПоБольничномуЛисту.Ссылка = Исправления.ПерерассчитываемыйДокумент
	|ГДЕ
	|	НачислениеПоБольничномуЛисту.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ НачислениеПоБольничномуЛисту.Организация В (&Организация))
	|	И НачислениеПоБольничномуЛисту.ПериодРегистрации <= &ТекущийПериод
	|	И Исправления.Ссылка ЕСТЬ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	ОплатаПоСреднемуЗаработку.Ссылка КАК Документ,
	|	ОплатаПоСреднемуЗаработку.ПериодРегистрации,
	|	ОплатаПоСреднемуЗаработку.Организация
	|ПОМЕСТИТЬ ВТОплатаПоСреднемуЗаработку
	|ИЗ
	|	Документ.ОплатаПоСреднемуЗаработку КАК ОплатаПоСреднемуЗаработку
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ОплатаПоСреднемуЗаработку КАК Исправления
	|		ПО ОплатаПоСреднемуЗаработку.Ссылка = Исправления.ПерерассчитываемыйДокумент
	|ГДЕ
	|	ОплатаПоСреднемуЗаработку.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ ОплатаПоСреднемуЗаработку.Организация В (&Организация))
	|	И ОплатаПоСреднемуЗаработку.ПериодРегистрации <= &ТекущийПериод
	|	И Исправления.Ссылка ЕСТЬ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	РасчетПриУвольненииРаботникаОрганизаций.Ссылка КАК Документ,
	|	РасчетПриУвольненииРаботникаОрганизаций.ПериодРегистрации,
	|	РасчетПриУвольненииРаботникаОрганизаций.Организация
	|ПОМЕСТИТЬ ВТРасчетПриУвольнении
	|ИЗ
	|	Документ.РасчетПриУвольненииРаботникаОрганизаций КАК РасчетПриУвольненииРаботникаОрганизаций
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РасчетПриУвольненииРаботникаОрганизаций КАК Исправления
	|		ПО РасчетПриУвольненииРаботникаОрганизаций.Ссылка = Исправления.ПерерассчитываемыйДокумент
	|ГДЕ
	|	РасчетПриУвольненииРаботникаОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ РасчетПриУвольненииРаботникаОрганизаций.Организация В (&Организация))
	|	И РасчетПриУвольненииРаботникаОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|	И Исправления.Ссылка ЕСТЬ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	РегистрацияПростоевРаботниковОрганизаций.Ссылка КАК Документ,
	|	РегистрацияПростоевРаботниковОрганизаций.ПериодРегистрации,
	|	РегистрацияПростоевРаботниковОрганизаций.Организация
	|ПОМЕСТИТЬ ВТРегистрацияПростоев
	|ИЗ
	|	Документ.РегистрацияПростоевРаботниковОрганизаций КАК РегистрацияПростоевРаботниковОрганизаций
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РегистрацияПростоевРаботниковОрганизаций КАК Исправления
	|		ПО РегистрацияПростоевРаботниковОрганизаций.Ссылка = Исправления.ПерерассчитываемыйДокумент
	|ГДЕ
	|	РегистрацияПростоевРаботниковОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ РегистрацияПростоевРаботниковОрганизаций.Организация В (&Организация))
	|	И РегистрацияПростоевРаботниковОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|	И Исправления.Ссылка ЕСТЬ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	ТекстЗапросаДополнительно = ПроведениеРасчетовПереопределяемый.ПолучитьТекстЗапросаДокументыКПерерасчетуДополнительно(ТекстПервыхЗаписей);
	Если Не ПустаяСтрока(ТекстЗапросаДополнительно) Тогда
		Запрос.Текст = ТекстЗапросаДополнительно;
		Запрос.Выполнить();
	КонецЕсли;	
	
	// документы к перерасчету предыдущих периодов с отбором по организации, но включая исправленные документы
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	НачислениеЗарплатыРаботникамОрганизаций.Ссылка КАК Документ,
	|	НачислениеЗарплатыРаботникамОрганизаций.ПериодРегистрации КАК ПериодРегистрации,
	|	НачислениеЗарплатыРаботникамОрганизаций.Организация
	|ПОМЕСТИТЬ ВТНачислениеЗарплаты
	|ИЗ
	|	Документ.НачислениеЗарплатыРаботникамОрганизаций КАК НачислениеЗарплатыРаботникамОрганизаций
	|ГДЕ
	|	НачислениеЗарплатыРаботникамОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ НачислениеЗарплатыРаботникамОрганизаций.Организация В (&Организация))
	|	И НачислениеЗарплатыРаботникамОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|	И (НачислениеЗарплатыРаботникамОрганизаций.Проведен
	|			ИЛИ НачислениеЗарплатыРаботникамОрганизаций.ПериодРегистрации = &ТекущийПериод)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.Ссылка КАК Документ,
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.ПериодРегистрации КАК ПериодРегистрации,
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.Организация
	|ПОМЕСТИТЬ ВТОплатаПраздничных
	|ИЗ
	|	Документ.ОплатаПраздничныхИВыходныхДнейОрганизаций КАК ОплатаПраздничныхИВыходныхДнейОрганизаций
	|ГДЕ
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ ОплатаПраздничныхИВыходныхДнейОрганизаций.Организация В (&Организация))
	|	И ОплатаПраздничныхИВыходныхДнейОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	НевыходыВОрганизациях.Ссылка КАК Документ,
	|	НевыходыВОрганизациях.ПериодРегистрации КАК ПериодРегистрации,
	|	НевыходыВОрганизациях.Организация
	|ПОМЕСТИТЬ ВТНевыходыВОрганизациях
	|ИЗ
	|	Документ.НевыходыВОрганизациях КАК НевыходыВОрганизациях
	|ГДЕ
	|	НевыходыВОрганизациях.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ НевыходыВОрганизациях.Организация В (&Организация))
	|	И НевыходыВОрганизациях.ПериодРегистрации <= &ТекущийПериод
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	ОплатаСверхурочныхЧасов.Ссылка КАК Документ,
	|	ОплатаСверхурочныхЧасов.ПериодРегистрации КАК ПериодРегистрации,
	|	ОплатаСверхурочныхЧасов.Организация
	|ПОМЕСТИТЬ ВТОплатаСверхурочныхЧасов
	|ИЗ
	|	Документ.ОплатаСверхурочныхЧасов КАК ОплатаСверхурочныхЧасов
	|ГДЕ
	|	ОплатаСверхурочныхЧасов.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ ОплатаСверхурочныхЧасов.Организация В (&Организация))
	|	И ОплатаСверхурочныхЧасов.ПериодРегистрации <= &ТекущийПериод
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	ПремииРаботниковОрганизаций.Ссылка КАК Документ,
	|	ПремииРаботниковОрганизаций.ПериодРегистрации КАК ПериодРегистрации,
	|	ПремииРаботниковОрганизаций.Организация
	|ПОМЕСТИТЬ ВТПремии
	|ИЗ
	|	Документ.ПремииРаботниковОрганизаций КАК ПремииРаботниковОрганизаций
	|ГДЕ
	|	ПремииРаботниковОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ ПремииРаботниковОрганизаций.Организация В (&Организация))
	|	И ПремииРаботниковОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ " + ТекстПервыхЗаписей + "
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.Ссылка КАК Документ,
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.ПериодРегистрации КАК ПериодРегистрации,
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.Организация
	|ПОМЕСТИТЬ ВТРазовыеНачисления
	|ИЗ
	|	Документ.РегистрацияРазовыхНачисленийРаботниковОрганизаций КАК РегистрацияРазовыхНачисленийРаботниковОрганизаций
	|ГДЕ
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТДокументыКПерерасчету КАК ДокументыКПерерасчету)
	|	И (&ПоВсемОрганизациям
	|			ИЛИ РегистрацияРазовыхНачисленийРаботниковОрганизаций.Организация В (&Организация))
	|	И РегистрацияРазовыхНачисленийРаботниковОрганизаций.ПериодРегистрации <= &ТекущийПериод
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	Запрос.Выполнить();
	
	// документы-исправления выбранных ранее документов, нуждающихся в перерасчете - только многострочные
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НачислениеЗарплатыРаботникамОрганизаций.Ссылка КАК Документ,
	|	НачислениеЗарплатыРаботникамОрганизаций.ПерерассчитываемыйДокумент КАК ИсходныйДокумент
	|ПОМЕСТИТЬ ВТДокументыИсправления
	|ИЗ
	|	Документ.НачислениеЗарплатыРаботникамОрганизаций КАК НачислениеЗарплатыРаботникамОрганизаций
	|ГДЕ
	|	НачислениеЗарплатыРаботникамОрганизаций.ПерерассчитываемыйДокумент В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТНачислениеЗарплаты КАК ДокументыКПерерасчету)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.Ссылка,
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.ПерерассчитываемыйДокумент
	|ИЗ
	|	Документ.ОплатаПраздничныхИВыходныхДнейОрганизаций КАК ОплатаПраздничныхИВыходныхДнейОрганизаций
	|ГДЕ
	|	ОплатаПраздничныхИВыходныхДнейОрганизаций.ПерерассчитываемыйДокумент В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТОплатаПраздничных КАК ДокументыКПерерасчету)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НевыходыВОрганизациях.Ссылка,
	|	НевыходыВОрганизациях.ПерерассчитываемыйДокумент
	|ИЗ
	|	Документ.НевыходыВОрганизациях КАК НевыходыВОрганизациях
	|ГДЕ
	|	НевыходыВОрганизациях.ПерерассчитываемыйДокумент В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТНевыходыВОрганизациях КАК ДокументыКПерерасчету)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОплатаСверхурочныхЧасов.Ссылка,
	|	ОплатаСверхурочныхЧасов.ПерерассчитываемыйДокумент
	|ИЗ
	|	Документ.ОплатаСверхурочныхЧасов КАК ОплатаСверхурочныхЧасов
	|ГДЕ
	|	ОплатаСверхурочныхЧасов.ПерерассчитываемыйДокумент В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТОплатаСверхурочныхЧасов КАК ДокументыКПерерасчету)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПремииРаботниковОрганизаций.Ссылка,
	|	ПремииРаботниковОрганизаций.ПерерассчитываемыйДокумент
	|ИЗ
	|	Документ.ПремииРаботниковОрганизаций КАК ПремииРаботниковОрганизаций
	|ГДЕ
	|	ПремииРаботниковОрганизаций.ПерерассчитываемыйДокумент В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТПремии КАК ДокументыКПерерасчету)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.Ссылка,
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.ПерерассчитываемыйДокумент
	|ИЗ
	|	Документ.РегистрацияРазовыхНачисленийРаботниковОрганизаций КАК РегистрацияРазовыхНачисленийРаботниковОрганизаций
	|ГДЕ
	|	РегистрацияРазовыхНачисленийРаботниковОрганизаций.ПерерассчитываемыйДокумент В
	|			(ВЫБРАТЬ
	|				ДокументыКПерерасчету.Документ
	|			ИЗ
	|				ВТРазовыеНачисления КАК ДокументыКПерерасчету)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ";
	
	Если Запрос.Выполнить().Выгрузить()[0].Количество = 0 Тогда // все многострочные документы оказались неисправленными, лишние запросы исполнять не будем 
		       
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации КАК ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Пометка,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ) КАК Наименование,
		|	ДокументыПерерасчета.Организация.Наименование КАК НаименованиеОрганизации,
		|	ДокументыПерерасчета.Документ КАК Ссылка,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНачислениеОтпуска КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНачислениеПоБольничномуЛисту КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТОплатаПоСреднемуЗаработку КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТРасчетПриУвольнении КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТРегистрацияПростоев КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНачислениеЗарплаты КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТОплатаПраздничных КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНевыходыВОрганизациях КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТОплатаСверхурочныхЧасов КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТПремии КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТРазовыеНачисления КАК ДокументыПерерасчета";
		
		ПроведениеРасчетовПереопределяемый.ДополнитьТекстЗапросаДокументыКПерерасчету(ТекстЗапроса);
		
		ТекстЗапроса = ТекстЗапроса + "
		|УПОРЯДОЧИТЬ ПО
		|	ПериодРегистрации";
		
	Иначе
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ КАК Документ,
		|	ДокументыПерерасчета.ПериодРегистрации КАК ПериодРегистрации,
		|	ДокументыПерерасчета.Организация
		|ПОМЕСТИТЬ ВТДокументыПерерасчетаСИсправленными
		|ИЗ
		|	ВТНачислениеЗарплаты КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТОплатаПраздничных КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНевыходыВОрганизациях КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТОплатаСверхурочныхЧасов КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТПремии КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТРазовыеНачисления КАК ДокументыПерерасчета
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Документ";
		Запрос.Выполнить();
		
		// физлица, чьи результаты расчетов устарели
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ОсновныеНачисленияРаботниковОрганизацийПерерасчетОсновныхНачислений.ФизЛицо КАК Физлицо,
		|	ОсновныеНачисленияРаботниковОрганизацийПерерасчетОсновныхНачислений.ОбъектПерерасчета КАК Ссылка
		|ПОМЕСТИТЬ ВТФизлицаПерерасчета
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ПерерасчетОсновныхНачислений КАК ОсновныеНачисленияРаботниковОрганизацийПерерасчетОсновныхНачислений
		|ГДЕ
		|	ОсновныеНачисленияРаботниковОрганизацийПерерасчетОсновныхНачислений.ОбъектПерерасчета В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыПерерасчетаСИсправленными КАК ДокументыКПерерасчету)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДополнительныеНачисленияРаботниковОрганизацийПерерасчетДополнительныхНачислений.ФизЛицо,
		|	ДополнительныеНачисленияРаботниковОрганизацийПерерасчетДополнительныхНачислений.ОбъектПерерасчета
		|ИЗ
		|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.ПерерасчетДополнительныхНачислений КАК ДополнительныеНачисленияРаботниковОрганизацийПерерасчетДополнительныхНачислений
		|ГДЕ
		|	ДополнительныеНачисленияРаботниковОрганизацийПерерасчетДополнительныхНачислений.ОбъектПерерасчета В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыПерерасчетаСИсправленными КАК ДокументыКПерерасчету)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	РасчетСреднегоЗаработкаПерерасчетСреднегоЗаработка.Физлицо,
		|	РасчетСреднегоЗаработкаПерерасчетСреднегоЗаработка.ОбъектПерерасчета
		|ИЗ
		|	РегистрРасчета.РасчетСреднегоЗаработка.ПерерасчетСреднегоЗаработка КАК РасчетСреднегоЗаработкаПерерасчетСреднегоЗаработка
		|ГДЕ
		|	РасчетСреднегоЗаработкаПерерасчетСреднегоЗаработка.ОбъектПерерасчета В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыПерерасчетаСИсправленными КАК ДокументыКПерерасчету)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		|	ДанныеДокументы.Физлицо,
		|	ЗаполнениеПлановыхНачислений.ОбъектЗаполнения
		|ИЗ
		|	РегистрСведений.ЗаполнениеПлановыхНачислений КАК ЗаполнениеПлановыхНачислений
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			НачислениеЗарплатыРаботникамОрганизацийНачисления.Сотрудник КАК Сотрудник,
		|			НачислениеЗарплатыРаботникамОрганизацийНачисления.Ссылка КАК Ссылка,
		|			НачислениеЗарплатыРаботникамОрганизацийНачисления.Физлицо КАК Физлицо
		|		ИЗ
		|			Документ.НачислениеЗарплатыРаботникамОрганизаций.Начисления КАК НачислениеЗарплатыРаботникамОрганизацийНачисления
		|		ГДЕ
		|			НачислениеЗарплатыРаботникамОрганизацийНачисления.Ссылка В
		|					(ВЫБРАТЬ
		|						ДокументыКПерерасчету.Документ
		|					ИЗ
		|						ВТДокументыПерерасчетаСИсправленными КАК ДокументыКПерерасчету
		|					ГДЕ
		|						ДокументыКПерерасчету.Документ ССЫЛКА Документ.НачислениеЗарплатыРаботникамОрганизаций)
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Сотрудник,
		|			НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Ссылка,
		|			НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Физлицо
		|		ИЗ
		|			Документ.НачислениеЗарплатыРаботникамОрганизаций.ДополнительныеНачисления КАК НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления
		|		ГДЕ
		|			НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Ссылка В
		|					(ВЫБРАТЬ
		|						ДокументыКПерерасчету.Документ
		|					ИЗ
		|						ВТДокументыПерерасчетаСИсправленными КАК ДокументыКПерерасчету
		|					ГДЕ
		|						ДокументыКПерерасчету.Документ ССЫЛКА Документ.НачислениеЗарплатыРаботникамОрганизаций)
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Сотрудник,
		|			НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Ссылка,
		|			НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Физлицо
		|		ИЗ
		|			Документ.НачислениеЗарплатыРаботникамОрганизаций.ДоговорыНаВыполнениеРабот КАК НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот
		|		ГДЕ
		|			НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Ссылка В
		|					(ВЫБРАТЬ
		|						ДокументыКПерерасчету.Документ
		|					ИЗ
		|						ВТДокументыПерерасчетаСИсправленными КАК ДокументыКПерерасчету
		|					ГДЕ
		|						ДокументыКПерерасчету.Документ ССЫЛКА Документ.НачислениеЗарплатыРаботникамОрганизаций)) КАК ДанныеДокументы
		|		ПО ЗаполнениеПлановыхНачислений.ОбъектЗаполнения = ДанныеДокументы.Ссылка
		|			И ЗаполнениеПлановыхНачислений.Сотрудник = ДанныеДокументы.Сотрудник
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка,
		|	Физлицо";
		Запрос.Выполнить();
		
		// физлица, чьи результаты расчетов уже исправляли, содержащие только таких сотрудников документы не предлагаем к перерасчету
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДокументыИсправления.ИсходныйДокумент КАК Ссылка,
		|	НачислениеЗарплатыРаботникамОрганизацийНачисления.Физлицо КАК Физлицо
		|ПОМЕСТИТЬ ВТФизлицаИсправлений
		|ИЗ
		|	Документ.НачислениеЗарплатыРаботникамОрганизаций.Начисления КАК НачислениеЗарплатыРаботникамОрганизацийНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыИсправления КАК ДокументыИсправления
		|		ПО НачислениеЗарплатыРаботникамОрганизацийНачисления.Ссылка = ДокументыИсправления.Документ
		|			И НачислениеЗарплатыРаботникамОрганизацийНачисления.СторнируемыйДокумент = ДокументыИсправления.ИсходныйДокумент
		|ГДЕ
		|	НачислениеЗарплатыРаботникамОрганизацийНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.НачислениеЗарплатыРаботникамОрганизаций)
		|	И НачислениеЗарплатыРаботникамОрганизацийНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыИсправления.ИсходныйДокумент,
		|	НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Физлицо
		|ИЗ
		|	Документ.НачислениеЗарплатыРаботникамОрганизаций.ДополнительныеНачисления КАК НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыИсправления КАК ДокументыИсправления
		|		ПО НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Ссылка = ДокументыИсправления.Документ
		|			И НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.СторнируемыйДокумент = ДокументыИсправления.ИсходныйДокумент
		|ГДЕ
		|	НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.НачислениеЗарплатыРаботникамОрганизаций)
		|	И НачислениеЗарплатыРаботникамОрганизацийДополнительныеНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыИсправления.ИсходныйДокумент,
		|	НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Физлицо
		|ИЗ
		|	Документ.НачислениеЗарплатыРаботникамОрганизаций.ДоговорыНаВыполнениеРабот КАК НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыИсправления КАК ДокументыИсправления
		|		ПО НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Ссылка = ДокументыИсправления.Документ
		|			И НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.СторнируемыйДокумент = ДокументыИсправления.ИсходныйДокумент
		|ГДЕ
		|	НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.НачислениеЗарплатыРаботникамОрганизаций)
		|	И НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыИсправления.ИсходныйДокумент,
		|	РегистрацияРазовыхНачисленийРаботниковОрганизацийОсновныеНачисления.Физлицо
		|ИЗ
		|	Документ.РегистрацияРазовыхНачисленийРаботниковОрганизаций.ОсновныеНачисления КАК РегистрацияРазовыхНачисленийРаботниковОрганизацийОсновныеНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыИсправления КАК ДокументыИсправления
		|		ПО РегистрацияРазовыхНачисленийРаботниковОрганизацийОсновныеНачисления.Ссылка = ДокументыИсправления.Документ
		|			И РегистрацияРазовыхНачисленийРаботниковОрганизацийОсновныеНачисления.СторнируемыйДокумент = ДокументыИсправления.ИсходныйДокумент
		|ГДЕ
		|	РегистрацияРазовыхНачисленийРаботниковОрганизацийОсновныеНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.РегистрацияРазовыхНачисленийРаботниковОрганизаций)
		|	И РегистрацияРазовыхНачисленийРаботниковОрганизацийОсновныеНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыИсправления.ИсходныйДокумент,
		|	РегистрацияРазовыхНачисленийРаботниковОрганизацийДополнительныеНачисления.Физлицо
		|ИЗ
		|	Документ.РегистрацияРазовыхНачисленийРаботниковОрганизаций.ДополнительныеНачисления КАК РегистрацияРазовыхНачисленийРаботниковОрганизацийДополнительныеНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыИсправления КАК ДокументыИсправления
		|		ПО РегистрацияРазовыхНачисленийРаботниковОрганизацийДополнительныеНачисления.Ссылка = ДокументыИсправления.Документ
		|			И РегистрацияРазовыхНачисленийРаботниковОрганизацийДополнительныеНачисления.СторнируемыйДокумент = ДокументыИсправления.ИсходныйДокумент
		|ГДЕ
		|	РегистрацияРазовыхНачисленийРаботниковОрганизацийДополнительныеНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.РегистрацияРазовыхНачисленийРаботниковОрганизаций)
		|	И РегистрацияРазовыхНачисленийРаботниковОрганизацийДополнительныеНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыИсправления.ИсходныйДокумент,
		|	НевыходыВОрганизацияхНачисления.Физлицо
		|ИЗ
		|	Документ.НевыходыВОрганизациях.Начисления КАК НевыходыВОрганизацияхНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыИсправления КАК ДокументыИсправления
		|		ПО НевыходыВОрганизацияхНачисления.Ссылка = ДокументыИсправления.Документ
		|			И НевыходыВОрганизацияхНачисления.СторнируемыйДокумент = ДокументыИсправления.ИсходныйДокумент
		|ГДЕ
		|	НевыходыВОрганизацияхНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.НевыходыВОрганизациях)
		|	И НевыходыВОрганизацияхНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ПремииРаботниковОрганизацийНачисления.Ссылка.ПерерассчитываемыйДокумент,
		|	ПремииРаботниковОрганизацийНачисления.Физлицо
		|ИЗ
		|	Документ.ПремииРаботниковОрганизаций.Начисления КАК ПремииРаботниковОрганизацийНачисления
		|ГДЕ
		|	ПремииРаботниковОрганизацийНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.ПремииРаботниковОрганизаций)
		|	И ПремииРаботниковОрганизацийНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОплатаПраздничныхИВыходныхДнейОрганизацийНачисления.Ссылка.ПерерассчитываемыйДокумент,
		|	ОплатаПраздничныхИВыходныхДнейОрганизацийНачисления.Физлицо
		|ИЗ
		|	Документ.ОплатаПраздничныхИВыходныхДнейОрганизаций.Начисления КАК ОплатаПраздничныхИВыходныхДнейОрганизацийНачисления
		|ГДЕ
		|	ОплатаПраздничныхИВыходныхДнейОрганизацийНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.ОплатаПраздничныхИВыходныхДнейОрганизаций)
		|	И ОплатаПраздничныхИВыходныхДнейОрганизацийНачисления.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОплатаСверхурочныхЧасовНачисления.Ссылка.ПерерассчитываемыйДокумент,
		|	ОплатаСверхурочныхЧасовНачисления.Физлицо
		|ИЗ
		|	Документ.ОплатаСверхурочныхЧасов.Начисления КАК ОплатаСверхурочныхЧасовНачисления
		|ГДЕ
		|	ОплатаСверхурочныхЧасовНачисления.Ссылка В
		|			(ВЫБРАТЬ
		|				ДокументыКПерерасчету.Документ
		|			ИЗ
		|				ВТДокументыИсправления КАК ДокументыКПерерасчету
		|			ГДЕ
		|				ДокументыКПерерасчету.Документ ССЫЛКА Документ.ОплатаСверхурочныхЧасов)
		|	И ОплатаСверхурочныхЧасовНачисления.Сторно
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка,
		|	Физлицо";
		Запрос.Выполнить();
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации КАК ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Пометка,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ) КАК Наименование,
		|	ДокументыПерерасчета.Организация.Наименование КАК НаименованиеОрганизации,
		|	ДокументыПерерасчета.Документ КАК Ссылка,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНачислениеОтпуска КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТНачислениеПоБольничномуЛисту КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТОплатаПоСреднемуЗаработку КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТРасчетПриУвольнении КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТРегистрацияПростоев КАК ДокументыПерерасчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ " + ТекстПервыхЗаписей + "
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.ПериодРегистрации,
		|	ВЫБОР
		|		КОГДА ДокументыПерерасчета.Документ В (&СписокПомеченныхДокументов)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ПРЕДСТАВЛЕНИЕ(ДокументыПерерасчета.Документ),
		|	ДокументыПерерасчета.Организация.Наименование,
		|	ДокументыПерерасчета.Документ,
		|	ДокументыПерерасчета.Организация
		|ИЗ
		|	ВТДокументыПерерасчетаСИсправленными КАК ДокументыПерерасчета
		|ГДЕ
		|	ДокументыПерерасчета.Документ В
		|			(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|				Документы.Ссылка КАК Ссылка
		|			ИЗ
		|				ВТФизлицаПерерасчета КАК Документы 
		|					ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаИсправлений КАК ДокументыИсправления
		|					ПО Документы.Ссылка = ДокументыИсправления.Ссылка
		|						И Документы.Физлицо = ДокументыИсправления.Физлицо
		|			ГДЕ
		|				ДокументыИсправления.Физлицо ЕСТЬ NULL )";
		
		ПроведениеРасчетовПереопределяемый.ДополнитьТекстЗапросаДокументыКПерерасчету(ТекстЗапроса);
		
		ТекстЗапроса = ТекстЗапроса + "
		|УПОРЯДОЧИТЬ ПО
		|	ПериодРегистрации";
		
	КонецЕсли;

	Запрос.Текст = ТекстЗапроса;
	Возврат Запрос.Выполнить()
	
КонецФункции

// Заполняет список физлиц по которым необходимо пересчитать зарплату по заданной организации
// Параметры: 
//	Организация - ссылка на организацию
// Возвращаемое значение:
//	Нет
//
Процедура ЗаполнитьДанныеПоОрганизации() Экспорт
	
	мПодразделенияДокументы.Очистить();
	мРаботникиДокументы.Очистить();
	
	СписокПодразделений.Очистить();
	СписокРаботников.Очистить();
	
	// пока не выбрана организация ничего не делаем
	Если Организация.Пустая() Тогда
		СписокДокументов.Очистить();
		Возврат;
	КонецЕсли;
	
	//запомним какие документы отмечены в списке документов
	СтруктураПоиска = Новый Структура;
	СтруктураПоиска.Вставить("Пометка", Истина);
	ТаблицаДокументов = СписокДокументов.Выгрузить();
	МассивСтрок = ТаблицаДокументов.НайтиСтроки(СтруктураПоиска);
	СписокПомеченныхДокументов = ТаблицаДокументов.Скопировать(МассивСтрок);
	//vvv
	СписокПомеченныхДокументов = ТаблицаДокументов.Скопировать(МассивСтрок).ВыгрузитьКолонку("Документ");
	
	Результат = СформироватьЗапрос(Организация, ТекущийПериод, СписокПомеченныхДокументов);
	СписокДокументов.Загрузить(Результат.Выгрузить());
	Возврат;
	//
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("Организация",	Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",	ОбщегоНазначения.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ТекущийПериод",	ТекущийПериод);
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	ПерерасчетОсновныхНачислений.ОбъектПерерасчета КАК Документ,
	|	ПерерасчетОсновныхНачислений.ОбъектПерерасчета.ПериодРегистрации КАК ПериодРегистрации
	|ИЗ
	|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ПерерасчетОсновныхНачислений КАК ПерерасчетОсновныхНачислений
	|ГДЕ
	|	ПерерасчетОсновныхНачислений.ОбъектПерерасчета.Организация = &Организация
	|	И ПерерасчетОсновныхНачислений.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПерерасчетДополнительныхНачислений.ОбъектПерерасчета,
	|	ПерерасчетДополнительныхНачислений.ОбъектПерерасчета.ПериодРегистрации
	|ИЗ
	|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.ПерерасчетДополнительныхНачислений КАК ПерерасчетДополнительныхНачислений
	|ГДЕ
	|	ПерерасчетДополнительныхНачислений.ОбъектПерерасчета.Организация = &Организация
	|	И ПерерасчетДополнительныхНачислений.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПерерасчетСреднегоЗаработка.ОбъектПерерасчета,
	|	ПерерасчетСреднегоЗаработка.ОбъектПерерасчета.ПериодРегистрации
	|ИЗ
	|	РегистрРасчета.РасчетСреднегоЗаработка.ПерерасчетСреднегоЗаработка КАК ПерерасчетСреднегоЗаработка
	|ГДЕ
	|	ПерерасчетСреднегоЗаработка.ОбъектПерерасчета.Организация = &Организация
	|	И ПерерасчетСреднегоЗаработка.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ЗаполнениеПлановыхНачислений.ОбъектЗаполнения,
	|	ЗаполнениеПлановыхНачислений.ПериодРегистрации
	|ИЗ
	|	РегистрСведений.ЗаполнениеПлановыхНачислений КАК ЗаполнениеПлановыхНачислений
	|ГДЕ
	|	ЗаполнениеПлановыхНачислений.ПериодРегистрации < &ТекущийПериод
	|	И ЗаполнениеПлановыхНачислений.ОбособленноеПодразделение = &Организация
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПериодРегистрации";
	
	СписокДокументов.Загрузить(Запрос.Выполнить().Выгрузить());
	
	Если СписокПомеченныхДокументов.Количество() > 0 Тогда
		
		МассивДокументов = СписокПомеченныхДокументов.ВыгрузитьКолонку("Документ");
		Для каждого ДокументСсылка Из МассивДокументов Цикл
			СтрокаСписка = СписокДокументов.Найти(ДокументСсылка, "Документ");
			Если Не СтрокаСписка = Неопределено Тогда
				СтрокаСписка.Пометка = Истина;
			КонецЕсли;	
		КонецЦикла;

	КонецЕсли;
	
КонецПроцедуры

// перерассчитать помеченные документы,
// в порядке от самого старого до самого нового.
Процедура Перерассчитать() Экспорт
	
	//vvv
	Заголовок = ОбщегоНазначенияЗК.КомментарийРасчета("Перерасчет документов");
	//
	ИндексСтрокиТаблицы = СписокДокументов.Количество();
	Пока ИндексСтрокиТаблицы > 0 Цикл
		ИндексСтрокиТаблицы = ИндексСтрокиТаблицы - 1;
		
		СтрокаТаблицы = СписокДокументов[ИндексСтрокиТаблицы];
		Если СтрокаТаблицы.Пометка Тогда
			//vvv
			// проверим можно ли что-то делать с документом
			ОписаниеПричиныОтказа = "";
			Если ПроведениеРасчетов.ДокументНельзяИзменятьЗаднимЧислом(СтрокаТаблицы.Документ, ОписаниеПричиныОтказа) Тогда
				ОбщегоНазначенияЗК.КомментарийРасчета(СтрЗаменить(ОписаниеПричиныОтказа,"Документ ",Строка(СтрокаТаблицы.Документ)), , "Открыть", СтрокаТаблицы.Документ,Перечисления.ВидыСообщений.ВажнаяИнформация);
				Продолжить;	
			КонецЕсли;
			//
			ДокументОбъект = СтрокаТаблицы.Документ.ПолучитьОбъект();
			Попытка
				ДокументОбъект.Перерассчитать();
				//vvv
				ОбщегоНазначенияЗК.КомментарийРасчета(Строка(ДокументОбъект) + " обработан успешно. ", Заголовок, "Открыть", СтрокаТаблицы.Документ);
				//
			Исключение
				//vvv
				//Сообщить("Документ " + Строка(ДокументОбъект) + " не может быть перерассчитан!
				//|" + ОписаниеОшибки());
				ОбщегоНазначенияЗК.КомментарийРасчета("Документ " + Строка(ДокументОбъект) + " не может быть перерассчитан!
				|" + ОписаниеОшибки(), , "Открыть", СтрокаТаблицы.Документ,Перечисления.ВидыСообщений.ВажнаяИнформация);
			КонецПопытки;
		КонецЕсли;
	КонецЦикла;
	ЗаполнитьДанныеПоОрганизации();
	
КонецПроцедуры

// удалить сведения о перерасчете помеченных документов
Процедура УдалитьСведенияОПерерасчете() Экспорт
	
	//vvv коментируем, добавляем ниже
	//ПерерасчетыПоДокументам = РегистрыРасчета.ОсновныеНачисленияРаботниковОрганизаций.Перерасчеты.ПерерасчетОсновныхНачислений.СоздатьНаборЗаписей();
	//ПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.Использование = Истина;
	//ПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.ВидСравнения = ВидСравнения.Равно;
	//
	//ДопПерерасчетыПоДокументам = РегистрыРасчета.ДополнительныеНачисленияРаботниковОрганизаций.Перерасчеты.ПерерасчетДополнительныхНачислений.СоздатьНаборЗаписей();
	//ДопПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.Использование = Истина;
	//ДопПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.ВидСравнения = ВидСравнения.Равно;
	//
	//СредПерерасчетыПоДокументам = РегистрыРасчета.РасчетСреднегоЗаработка.Перерасчеты.ПерерасчетСреднегоЗаработка.СоздатьНаборЗаписей();
	//СредПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.Использование = Истина;
	//СредПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.ВидСравнения = ВидСравнения.Равно;
	//
	//НаборПерезаполнения = РегистрыСведений.ЗаполнениеПлановыхНачислений.СоздатьНаборЗаписей();
	//НаборПерезаполнения.Отбор.ОбъектЗаполнения.Использование = Истина;
	//НаборПерезаполнения.Отбор.ОбъектЗаполнения.ВидСравнения = ВидСравнения.Равно;
	//
	//Для Каждого СтрокаТаблицы Из СписокДокументов Цикл
	//	Если СтрокаТаблицы.Пометка Тогда
	//		ТипРегистратора = ТипЗнч(СтрокаТаблицы.Документ);
	//		Если ПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.ТипЗначения.СодержитТип(ТипРегистратора) тогда
	//			ПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.Значение = СтрокаТаблицы.Документ;
	//			ПерерасчетыПоДокументам.Записать(Истина);
	//		КонецЕсли;
	//		Если ДопПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.ТипЗначения.СодержитТип(ТипРегистратора) тогда
	//			ДопПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.Значение = СтрокаТаблицы.Документ;
	//			ДопПерерасчетыПоДокументам.Записать(Истина);
	//		КонецЕсли;
	//		Если СредПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.ТипЗначения.СодержитТип(ТипРегистратора) тогда
	//			СредПерерасчетыПоДокументам.Отбор.ОбъектПерерасчета.Значение = СтрокаТаблицы.Документ;
	//			СредПерерасчетыПоДокументам.Записать(Истина);
	//		КонецЕсли;
	//		Если НаборПерезаполнения.Отбор.ОбъектЗаполнения.ТипЗначения.СодержитТип(ТипРегистратора) Тогда
	//			НаборПерезаполнения.Отбор.ОбъектЗаполнения.Значение = СтрокаТаблицы.Документ;
	//			НаборПерезаполнения.Записать(Истина);
	//		КонецЕсли;
	//	КонецЕсли;
	//КонецЦикла;
	Для Каждого СтрокаТаблицы Из СписокДокументов.НайтиСтроки(Новый Структура("Пометка", Истина)) Цикл
		ПроведениеРасчетов.УдалитьСведенияОПерерасчетеДокумента(СтрокаТаблицы.Документ);
		ПроведениеРасчетов.УдалитьСведенияОПерезаполненииДокумента(СтрокаТаблицы.Документ);
	КонецЦикла;
	//
	
	ЗаполнитьДанныеПоОрганизации();
	
КонецПроцедуры

// заполняет табличную часть СписокПодразделений и соответсвие мПодразделенияДокументы 
// предназначенные для выполнения команды "отметить по подразделениеям"
Процедура ЗаполнитьСписокПодразделений() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ТекущийПериод", ТекущийПериод);
	Запрос.УстановитьПараметр("Организация", Организация);
	//vvv
	Запрос.УстановитьПараметр("Организация", ОбщегоНазначенияЗК.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ОбособленноеПодразделение", Организация);
	//

	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Перерасчет.ФизЛицо КАК ФизЛицо,
	|	Перерасчет.ОбъектПерерасчета КАК Документ
	|ПОМЕСТИТЬ ВТСписокФизлиц
	|ИЗ
	|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ПерерасчетОсновныхНачислений КАК Перерасчет
	|ГДЕ
	//vvv
	//|	Перерасчет.ОбъектПерерасчета.Организация = &Организация
	|	Перерасчет.ОбъектПерерасчета.Организация = &ОбособленноеПодразделение
	//
	|	И Перерасчет.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Перерасчет.ФизЛицо,
	|	Перерасчет.ОбъектПерерасчета КАК Документ
	|ИЗ
	|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.ПерерасчетДополнительныхНачислений КАК Перерасчет
	|ГДЕ
	//vvv
	//|	Перерасчет.ОбъектПерерасчета.Организация = &Организация
	|	Перерасчет.ОбъектПерерасчета.Организация = &ОбособленноеПодразделение
	//
	|	И Перерасчет.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Перерасчет.Физлицо,
	|	Перерасчет.ОбъектПерерасчета КАК Документ
	|ИЗ
	|	РегистрРасчета.РасчетСреднегоЗаработка.ПерерасчетСреднегоЗаработка КАК Перерасчет
	|ГДЕ
	//vvv
	//|	Перерасчет.ОбъектПерерасчета.Организация = &Организация
	|	Перерасчет.ОбъектПерерасчета.Организация = &ОбособленноеПодразделение
	//
	|	И Перерасчет.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаполнениеПлановыхНачислений.Сотрудник.Физлицо,
	|	ЗаполнениеПлановыхНачислений.ОбъектЗаполнения КАК Документ
	|ИЗ
	|	РегистрСведений.ЗаполнениеПлановыхНачислений КАК ЗаполнениеПлановыхНачислений
	|ГДЕ
	|	ЗаполнениеПлановыхНачислений.ПериодРегистрации < &ТекущийПериод
	//vvv
	//|	И ЗаполнениеПлановыхНачислений.ОбособленноеПодразделение = &Организация
	|	И ЗаполнениеПлановыхНачислений.ОбособленноеПодразделение = &ОбособленноеПодразделение
	//
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизЛицо
	//vvv
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	Перерасчеты.Документ КАК Документ,
	|	ВЫБОР
	|		КОГДА Работники.ПериодЗавершения <= &ТекущийПериод
	|				И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА Работники.ПодразделениеОрганизацииЗавершения.Наименование
	|		ИНАЧЕ Работники.ПодразделениеОрганизации.Наименование
	|	КОНЕЦ КАК ПодразделениеНаименование,
	|	ВЫБОР
	|		КОГДА Работники.ПериодЗавершения <= &ТекущийПериод
	|				И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА Работники.ПодразделениеОрганизацииЗавершения
	|		ИНАЧЕ Работники.ПодразделениеОрганизации
	|	КОНЕЦ КАК Подразделение
	|ИЗ
	|	ВТСписокФизлиц КАК Перерасчеты
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&ТекущийПериод,
	|				Организация = &Организация
	|					И Сотрудник.Физлицо В
	|						(ВЫБРАТЬ
	|							СписокФизлиц.ФизЛицо
	|						ИЗ
	|							ВТСписокФизлиц КАК СписокФизлиц)) КАК Работники
	|		ПО Перерасчеты.ФизЛицо = Работники.Сотрудник.Физлицо
	|ГДЕ
	|	ВЫБОР
	|			КОГДА Работники.ПериодЗавершения <= &ТекущийПериод
	|					И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА Работники.ОбособленноеПодразделениеЗавершения
	|			ИНАЧЕ Работники.ОбособленноеПодразделение
	|		КОНЕЦ = &ОбособленноеПодразделение
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПодразделениеНаименование";
	//vvv
	//vvv комментируем
	//Запрос.Выполнить();
	//
	//Запрос.Текст = 
	//"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	//|	Перерасчеты.Документ КАК Документ,
	//|	ВЫБОР
	//|		КОГДА Работники.ПериодЗавершения <= &ТекущийПериод
	//|				И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//|			ТОГДА Работники.ПодразделениеОрганизацииЗавершения.Наименование
	//|		ИНАЧЕ Работники.ПодразделениеОрганизации.Наименование
	//|	КОНЕЦ КАК ПодразделениеНаименование,
	//|	ВЫБОР
	//|		КОГДА Работники.ПериодЗавершения <= &ТекущийПериод
	//|				И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//|			ТОГДА Работники.ПодразделениеОрганизацииЗавершения
	//|		ИНАЧЕ Работники.ПодразделениеОрганизации
	//|	КОНЕЦ КАК Подразделение
	//|ИЗ
	//|	ВТСписокФизлиц КАК Перерасчеты
	//|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	//|				&ТекущийПериод,
	//|				Организация = &Организация
	//|					И Сотрудник.Физлицо В
	//|						(ВЫБРАТЬ ФизЛицо ИЗ ВТСписокФизлиц)) КАК Работники
	//|		ПО Перерасчеты.ФизЛицо = Работники.Сотрудник.Физлицо
	//|
	//|УПОРЯДОЧИТЬ ПО
	//|	ПодразделениеНаименование";
	//
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		ДокументыМассив = мПодразделенияДокументы.Получить(Выборка.Подразделение);
		Если ДокументыМассив = НеОпределено Тогда
			ДокументыМассив = Новый Массив;
			ДокументыМассив.Добавить(Выборка.Документ);
			мПодразделенияДокументы[Выборка.Подразделение] = ДокументыМассив;
			Строка = СписокПодразделений.Добавить();
			Строка.Подразделение = Выборка.Подразделение;
			Строка.ПодразделениеНаименование = Выборка.ПодразделениеНаименование;
		Иначе
			ДокументыМассив.Добавить(Выборка.Документ);
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

// заполняет табличную часть СписокРаботников и соответсвие мРаботникиДокументы 
// предназначенные для выполнения команды "отметить по подразделениям"
Процедура ЗаполнитьСписокРаботников() Экспорт
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("ТекущийПериод", ТекущийПериод);
	Запрос.УстановитьПараметр("Организация", Организация);

	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	Перерасчет.ФизЛицо КАК ФизЛицо,
	|	Перерасчет.ФизЛицо.Наименование КАК ФизЛицоНаименование,
	|	Перерасчет.ОбъектПерерасчета КАК Документ
	|ИЗ
	|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ПерерасчетОсновныхНачислений КАК Перерасчет
	|ГДЕ
	|	Перерасчет.ОбъектПерерасчета.Организация = &Организация
	|	И Перерасчет.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Перерасчет.ФизЛицо,
	|	Перерасчет.ФизЛицо.Наименование,
	|	Перерасчет.ОбъектПерерасчета
	|ИЗ
	|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций.ПерерасчетДополнительныхНачислений КАК Перерасчет
	|ГДЕ
	|	Перерасчет.ОбъектПерерасчета.Организация = &Организация
	|	И Перерасчет.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Перерасчет.Физлицо,
	|	Перерасчет.Физлицо.Наименование,
	|	Перерасчет.ОбъектПерерасчета
	|ИЗ
	|	РегистрРасчета.РасчетСреднегоЗаработка.ПерерасчетСреднегоЗаработка КАК Перерасчет
	|ГДЕ
	|	Перерасчет.ОбъектПерерасчета.Организация = &Организация
	|	И Перерасчет.ОбъектПерерасчета.ПериодРегистрации < &ТекущийПериод
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаполнениеПлановыхНачислений.Сотрудник.Физлицо,
	|	ЗаполнениеПлановыхНачислений.Сотрудник.Физлицо.Наименование,
	|	ЗаполнениеПлановыхНачислений.ОбъектЗаполнения
	|ИЗ
	|	РегистрСведений.ЗаполнениеПлановыхНачислений КАК ЗаполнениеПлановыхНачислений
	|ГДЕ
	|	ЗаполнениеПлановыхНачислений.ПериодРегистрации < &ТекущийПериод
	|	И ЗаполнениеПлановыхНачислений.ОбособленноеПодразделение = &Организация
	|
	|УПОРЯДОЧИТЬ ПО
	|	ФизЛицоНаименование";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		ДокументыМассив = мРаботникиДокументы.Получить(Выборка.Физлицо);
		Если ДокументыМассив = НеОпределено Тогда
			ДокументыМассив = Новый Массив;
			ДокументыМассив.Добавить(Выборка.Документ);
			мРаботникиДокументы[Выборка.Физлицо] = ДокументыМассив;
			Строка = СписокРаботников.Добавить();
			Строка.Работник = Выборка.Физлицо;
			Строка.РаботникНаименование = Выборка.ФизЛицоНаименование;
		Иначе
			ДокументыМассив.Добавить(Выборка.Документ);
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

мПодразделенияДокументы = Новый Соответствие;
мРаботникиДокументы = Новый Соответствие;
